<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡ç™»å…¥ - ç‰éœ²å¯¶åº«</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0b1021 0%, #1a2c4e 100%);
            --suisei-cyan: #3bc6e4;
            --neon-gold: #f2c94c;
            --glass: rgba(255, 255, 255, 0.05);
        }
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: var(--bg-gradient);
            color: #fff;
            height: 100vh;
            display: flex; align-items: center; justify-content: center;
            margin: 0; overflow: hidden;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background-image: radial-gradient(2px 2px at 20px 30px, #fff, rgba(0,0,0,0)), radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0)); background-size: 200px 200px; opacity: 0.2; z-index: -1; }

        .login-card {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 40px; border-radius: 20px; width: 320px; text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .login-card h2 { 
            margin-bottom: 30px; color: var(--suisei-cyan); 
            text-shadow: 0 0 10px rgba(59, 198, 228, 0.5); 
            font-size: 1.8rem; letter-spacing: 2px;
        }
        
        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .input-group { margin-bottom: 20px; position: relative; text-align: left; }
        .input-label { font-size: 0.9rem; color: #aaa; margin-bottom: 5px; display: block; margin-left: 5px; }
        
        .input-wrapper { position: relative; }
        .input-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; transition: 0.3s; }
        
        .input-wrapper input {
            width: 100%; padding: 12px 12px 12px 45px;
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px; color: #fff; outline: none; box-sizing: border-box; transition: 0.3s; font-size: 1rem;
        }
        .input-wrapper input:focus { border-color: var(--suisei-cyan); box-shadow: 0 0 10px rgba(59, 198, 228, 0.2); }
        .input-wrapper input:focus + i { color: var(--suisei-cyan); }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-login {
            width: 100%; padding: 12px; background: linear-gradient(90deg, var(--suisei-cyan), #0072ff);
            border: none; border-radius: 50px; color: #fff; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; transition: 0.3s; margin-top: 10px;
        }
        .btn-login:hover { transform: scale(1.03); box-shadow: 0 0 20px rgba(59, 198, 228, 0.4); }
        .btn-login:disabled { background: #555; cursor: not-allowed; transform: none; }

        /* è¨˜ä½æˆ‘ Checkbox */
        .options-row {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 20px; font-size: 0.9rem; color: #ccc;
            padding: 0 5px;
        }
        .checkbox-container { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .checkbox-container input { accent-color: var(--suisei-cyan); width: 16px; height: 16px; cursor: pointer; }

        .back-link { margin-top: 20px; display: block; color: #888; text-decoration: none; font-size: 0.9rem; transition: 0.3s; }
        .back-link:hover { color: #fff; }

        /* éŒ¯èª¤è¨Šæ¯ */
        .error-msg { color: #ff4757; font-size: 0.9rem; margin-top: 10px; min-height: 20px; }
    </style>
</head>
<body>
    <div class="stars-bg"></div>

    <div class="login-card">
        <h2><i class="fa-solid fa-user-astronaut"></i> æœƒå“¡ç™»å…¥</h2>
        
        <div class="input-group">
            <label class="input-label">å¸³è™Ÿ (Email)</label>
            <div class="input-wrapper">
                <input type="email" id="email" placeholder="name@example.com">
                <i class="fa-solid fa-envelope"></i>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label">å¯†ç¢¼</label>
            <div class="input-wrapper">
                <input type="password" id="password" placeholder="è¼¸å…¥å¯†ç¢¼">
                <i class="fa-solid fa-lock"></i>
            </div>
        </div>

        <div class="options-row">
            <label class="checkbox-container">
                <input type="checkbox" id="rememberMe"> 
                <span>è¨˜ä½æˆ‘</span>
            </label>
            </div>

        <button class="btn-login" id="loginBtn" onclick="handleLogin()">ç™»å…¥</button>
        <div class="error-msg" id="errorMsg"></div>

        <a href="index.html" class="back-link">è¿”å›é¦–é </a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ğŸ”¥ Config
        const firebaseConfig = {
            apiKey: "AIzaSyAAo6on0f2QUbPaRfxpIEb2uvhKxDvPUvs",
            authDomain: "yulubox.firebaseapp.com",
            projectId: "yulubox",
            storageBucket: "yulubox.firebasestorage.app",
            messagingSenderId: "256466567852",
            appId: "1:256466567852:web:233b74668908ffcb9b9509",
            measurementId: "G-YPCY41EKWX"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // ğŸ§  é é¢è¼‰å…¥æ™‚ï¼šæª¢æŸ¥æ˜¯å¦æœ‰ã€Œè¨˜ä½æˆ‘ã€çš„è³‡æ–™
        window.addEventListener('load', () => {
            const savedEmail = localStorage.getItem('yulubox_remember_email');
            if (savedEmail) {
                document.getElementById('email').value = savedEmail;
                document.getElementById('rememberMe').checked = true;
            }
        });

        // ç›£è½ç™»å…¥ç‹€æ…‹ï¼šå¦‚æœå·²ç™»å…¥ï¼Œç›´æ¥è·³è½‰
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = 'vip_area.html';
            }
        });

        window.handleLogin = function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const errorDiv = document.getElementById('errorMsg');
            const btn = document.getElementById('loginBtn');

            if(!email || !password) {
                errorDiv.innerText = "è«‹è¼¸å…¥å¸³è™Ÿèˆ‡å¯†ç¢¼";
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> é©—è­‰ä¸­...';
            errorDiv.innerText = "";

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // âœ… ç™»å…¥æˆåŠŸ
                    
                    // è™•ç†ã€Œè¨˜ä½æˆ‘ã€é‚è¼¯
                    if (rememberMe) {
                        localStorage.setItem('yulubox_remember_email', email);
                    } else {
                        localStorage.removeItem('yulubox_remember_email');
                    }

                    // é é¢è·³è½‰ (onAuthStateChanged æœƒè™•ç†ï¼Œé€™è£¡ä¸ç”¨å¯«)
                })
                .catch((error) => {
                    // âŒ ç™»å…¥å¤±æ•—
                    btn.disabled = false;
                    btn.innerText = "ç™»å…¥";
                    console.error(error);

                    switch(error.code) {
                        case 'auth/invalid-email':
                            errorDiv.innerText = "Email æ ¼å¼éŒ¯èª¤";
                            break;
                        case 'auth/user-not-found':
                        case 'auth/invalid-credential':
                            errorDiv.innerText = "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤";
                            break;
                        case 'auth/wrong-password':
                            errorDiv.innerText = "å¯†ç¢¼éŒ¯èª¤";
                            break;
                        case 'auth/too-many-requests':
                            errorDiv.innerText = "å˜—è©¦æ¬¡æ•¸éå¤šï¼Œè«‹ç¨å¾Œå†è©¦";
                            break;
                        default:
                            errorDiv.innerText = "ç™»å…¥å¤±æ•—ï¼š" + error.message;
                    }
                });
        }
        
        // æ”¯æ´æŒ‰ Enter ç™»å…¥
        document.getElementById('password').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') handleLogin();
        });
    </script>
</body>
</html>