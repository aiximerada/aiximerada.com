<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª²ç¨‹åˆ†æåœ–è¡¨ - STEAM å­¸ç¿’æ­·ç¨‹åˆ†æ</title>
    <!-- å¼•å…¥ Tailwind CSS ç”¨æ–¼å¿«é€Ÿä¸”éŸ¿æ‡‰å¼çš„æ’ç‰ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Chart.js ç”¨æ–¼ç¹ªè£½åœ–è¡¨ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 300px; 
            transition: all 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
            .line-chart-container { height: 450px; }
        }

        .filter-toggle { display: none; }
        
        .filter-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-width: 2px;
            opacity: 0.5;
            filter: grayscale(0.8);
            background-color: white;
            user-select: none;
        }

        .filter-toggle:checked + .filter-btn {
            opacity: 1;
            filter: grayscale(0);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
        }

        .filter-btn:hover {
            opacity: 0.8;
            filter: grayscale(0.4);
        }
        .filter-toggle:checked + .filter-btn:hover {
            opacity: 1;
        }

        .chart-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .chart-card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        }
    </style>
</head>
<body class="text-slate-700 antialiased p-4 md:p-8 min-h-screen">

    <div class="max-w-7xl mx-auto space-y-8 relative">
        
        <!-- é é¢æ¨™é¡Œå€å¡Š -->
        <header class="text-center mb-12 pt-4">
            <div class="inline-block bg-indigo-50 text-indigo-600 px-4 py-1.5 rounded-full text-sm font-semibold tracking-wide mb-4 shadow-sm border border-indigo-100">
                STEAM å­¸ç¿’æ­·ç¨‹åˆ†æ
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-slate-800 to-slate-500 mb-3 tracking-tight">
                èª²ç¨‹åˆ†æåœ–è¡¨
            </h1>
            <p class="text-slate-500 text-lg md:text-xl font-light">èƒ½åŠ›åˆ†ä½ˆèˆ‡æ“ä½œæ™‚é–“ç´€éŒ„å„€è¡¨æ¿</p>
        </header>

        <!-- ä¸ŠåŠéƒ¨ï¼šSTEAM åœ–è¡¨åˆ†æå€ -->
        <section class="bg-white rounded-[2rem] shadow-lg shadow-slate-200/50 border border-slate-100 overflow-hidden">
            <div class="bg-gradient-to-r from-slate-50 to-white border-b border-slate-100 px-8 py-5 flex items-center justify-between">
                <div class="flex items-center">
                    <div class="bg-indigo-100 p-2 rounded-xl mr-4 shadow-sm">
                        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800 tracking-wide">èƒ½åŠ›åˆ†ä½ˆæŒ‡æ¨™</h2>
                </div>
                <div class="text-sm text-slate-500 font-medium">
                    åŸºæº–å°æ¯”å¯¦éš›è¡¨ç¾
                </div>
            </div>
            
            <div class="p-6 md:p-8">
                <!-- é›™åœ–è¡¨ä¸¦æ’æ’ç‰ˆ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                    
                    <!-- å­¸ç”Ÿè¡¨ç¾æ¯”ä¾‹ (å–®ç’°åœ“é¤…åœ–) -->
                    <div class="chart-card bg-slate-50/50 rounded-3xl p-6 border border-slate-100/50 relative">
                        <div class="absolute top-4 left-6 flex items-center space-x-2 z-10">
                            <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                            <h3 class="text-sm font-bold text-slate-600 uppercase tracking-wider flex items-center">
                                èƒ½åŠ›çµ„æˆ (åœ“é¤…åœ–)
                                <!-- èªªæ˜æŒ‰éˆ• -->
                                <button onclick="openInfoModal('pie')" class="ml-2 text-indigo-400 hover:text-indigo-600 focus:outline-none transition-colors" title="åœ–è¡¨èªªæ˜">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                                </button>
                            </h3>
                        </div>
                        <div class="text-xs text-slate-400 absolute top-4 right-6 text-right z-10">
                            å¯¦éš›è¡¨ç¾
                        </div>
                        <div class="chart-container mt-6">
                            <canvas id="pieAreaChart"></canvas>
                        </div>
                    </div>

                    <!-- å­¸ç”Ÿ vs èª²ç¨‹å°æ¯”é›·é” -->
                    <div class="chart-card bg-slate-50/50 rounded-3xl p-6 border border-slate-100/50 relative">
                         <div class="absolute top-4 left-6 flex items-center space-x-2 z-10">
                            <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                            <h3 class="text-sm font-bold text-slate-600 uppercase tracking-wider flex items-center">
                                èƒ½åŠ›å½¢ç‹€å·®ç•° (é›·é”åœ–)
                                <!-- èªªæ˜æŒ‰éˆ• -->
                                <button onclick="openInfoModal('radar')" class="ml-2 text-indigo-400 hover:text-indigo-600 focus:outline-none transition-colors" title="åœ–è¡¨èªªæ˜">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                                </button>
                            </h3>
                        </div>
                        <div class="chart-container mt-6">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- ä¸‹åŠéƒ¨ï¼šæ™‚é–“ç´€éŒ„å€ -->
        <section class="bg-white rounded-[2rem] shadow-lg shadow-slate-200/50 border border-slate-100 overflow-hidden">
            <div class="bg-gradient-to-r from-slate-50 to-white border-b border-slate-100 px-8 py-5 flex items-center justify-between">
                <div class="flex items-center">
                    <div class="bg-emerald-100 p-2 rounded-xl mr-4 shadow-sm">
                        <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800 tracking-wide flex items-center">
                        æ“ä½œæ™‚é–“ç´€éŒ„
                        <!-- èªªæ˜æŒ‰éˆ• -->
                        <button onclick="openInfoModal('timeline')" class="ml-3 text-emerald-500 hover:text-emerald-700 focus:outline-none transition-colors" title="åœ–è¡¨èªªæ˜">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                </div>
                
                <button id="showAllBtn" class="px-5 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-full shadow-md hover:shadow-lg transition-all text-sm font-semibold flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    é‡ç½®é¡¯ç¤º
                </button>
            </div>
            
            <div class="p-8">
                <!-- éšæ®µå€åŸŸé¡¯ç¤ºæ§åˆ¶é … -->
                <div class="mb-6 flex flex-wrap items-center justify-center gap-3 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                    <span class="text-sm font-bold text-slate-500 mr-2 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg>
                        èšç„¦å€åŸŸï¼š
                    </span>
                    
                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="zone-toggle filter-toggle" value="zone1" checked>
                        <!-- ç§»é™¤äº†æŒ‰éˆ•ä¸Šçš„æ•¸å­—æ¨™ç¤º -->
                        <div class="filter-btn px-4 py-1.5 rounded-full flex items-center gap-2 text-sm font-medium text-slate-600 border-slate-200 bg-slate-100/50 hover:bg-slate-200/50">
                            æ•™æå€
                        </div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="zone-toggle filter-toggle" value="zone2" checked>
                        <div class="filter-btn px-4 py-1.5 rounded-full flex items-center gap-2 text-sm font-medium text-slate-600 border-slate-200 bg-slate-100/50 hover:bg-slate-200/50">
                            é€²éšä¸€
                        </div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="zone-toggle filter-toggle" value="zone3" checked>
                        <div class="filter-btn px-4 py-1.5 rounded-full flex items-center gap-2 text-sm font-medium text-slate-600 border-slate-200 bg-slate-100/50 hover:bg-slate-200/50">
                            é€²éšäºŒ
                        </div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="zone-toggle filter-toggle" value="zone4" checked>
                        <div class="filter-btn px-4 py-1.5 rounded-full flex items-center gap-2 text-sm font-medium text-slate-600 border-slate-200 bg-slate-100/50 hover:bg-slate-200/50">
                            é€²éšä¸‰
                        </div>
                    </label>
                </div>

                <!-- è‡ªè¨‚åœ–ä¾‹èˆ‡éæ¿¾æ§åˆ¶é … -->
                <div class="mb-4 flex flex-wrap items-center justify-center gap-3">
                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="filter-toggle dataset-toggle" value="0" checked>
                        <div class="filter-btn px-4 py-2 rounded-full flex items-center gap-2 font-medium text-slate-700" style="border-color: #A9D0F5; background-color: #f0f7ff;">
                            <span class="w-3 h-3 rounded-full shadow-sm" style="background-color: #A9D0F5;"></span>é»ƒéƒä¿Š
                        </div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="filter-toggle dataset-toggle" value="1" checked>
                        <div class="filter-btn px-4 py-2 rounded-full flex items-center gap-2 font-medium text-slate-700" style="border-color: #fca5a5; background-color: #fef2f2;">
                            <span class="w-3 h-3 rounded-full shadow-sm" style="background-color: #fca5a5;"></span>ç‹xx
                        </div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="filter-toggle dataset-toggle" value="2" checked>
                        <div class="filter-btn px-4 py-2 rounded-full flex items-center gap-2 font-medium text-slate-700" style="border-color: #84cc16; background-color: #f7fee7;">
                            <span class="w-3 h-3 rounded-full shadow-sm" style="background-color: #84cc16;"></span>é«˜xx
                        </div>
                    </label>

                    <label class="cursor-pointer relative">
                        <input type="checkbox" class="filter-toggle dataset-toggle" value="3" checked>
                        <div class="filter-btn px-4 py-2 rounded-full flex items-center gap-2 font-medium text-slate-700" style="border-color: #c084fc; background-color: #faf5ff;">
                            <span class="w-3 h-3 rounded-full shadow-sm" style="background-color: #c084fc;"></span>é™³xx
                        </div>
                    </label>

                     <label class="cursor-pointer relative">
                        <input type="checkbox" class="filter-toggle dataset-toggle" value="4" checked>
                        <div class="filter-btn px-4 py-2 rounded-full flex items-center gap-2 font-medium text-slate-700" style="border-color: #fde047; background-color: #fefce8;">
                            <span class="w-3 h-3 rounded-full shadow-sm" style="background-color: #fde047;"></span>æ—xx
                        </div>
                    </label>
                </div>
                
                <div class="text-center text-xs text-slate-400 mb-6 flex items-center justify-center">
                    <span class="inline-block text-[10px] mr-1">â­ï¸</span> å¯¦å¿ƒæ˜Ÿæ˜Ÿä»£è¡¨è©²å­¸ç”Ÿåœ¨è©²éšæ®µé”æˆçš„ã€Œæœ€é«˜å®Œæˆé»ã€(å¿½ç•¥ä¸­é€”æ‰è½)
                </div>

                <!-- æŠ˜ç·šåœ–å®¹å™¨ -->
                <div class="chart-container line-chart-container w-full">
                    <canvas id="timeLineChart"></canvas>
                </div>
            </div>
        </section>

    </div>

    <!-- èªªæ˜å½ˆçª— Modal -->
    <div id="infoModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-slate-900/40 backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-11/12 max-w-sm transform scale-95 transition-transform" id="infoModalContent">
            <div class="flex justify-between items-start mb-4">
                <h3 id="infoModalTitle" class="text-xl font-bold text-slate-800">æ¨™é¡Œ</h3>
                <button onclick="closeInfoModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <p id="infoModalBody" class="text-slate-600 leading-relaxed text-sm"></p>
            <div class="mt-6 flex justify-end">
                <button onclick="closeInfoModal()" class="px-5 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg font-medium transition-colors">
                    æˆ‘çŸ¥é“äº†
                </button>
            </div>
        </div>
    </div>

    <script>
        /**
         * ==========================================
         * ç³»çµ±è‡ªå‹•ç”Ÿæˆè³‡æ–™å€å¡Š (å¾Œç«¯åªéœ€ä¿®æ”¹æ­¤è™• JSON)
         * ==========================================
         */
        const chartData = {
            labels: ['ç§‘å­¸', 'æŠ€è¡“', 'å·¥ç¨‹', 'è—è¡“', 'æ•¸å­¸'],
            colors: {
                science: '#fca5a5', 
                tech: '#fde047',    
                eng: '#93c5fd',     
                art: '#c084fc',     
                math: '#94a3b8'     
            },
            baseData: [2, 4.5, 3, 2, 2.5],
            studentData: [1.5, 3, 4, 1.5, 2],
            timeLineXMax: 6000,
            // æ³¨æ„ï¼šæ‰€æœ‰çš„ 0 èµ·é»å·²æ›´æ–°ç‚º 1
            timeLineDatasets: [
                {
                    label: 'é»ƒéƒä¿Š', 
                    borderColor: '#93c5fd',
                    backgroundColor: 'rgba(147, 197, 253, 0.2)',
                    borderDash: [], 
                    data: [ {x:0, y:1}, {x:50, y:10}, {x:100, y:2}, {x:800, y:5}, {x:1000, y:10}, {x:1500, y:2} ]
                },
                {
                    label: 'ç‹xx',
                    borderColor: '#fca5a5',
                    backgroundColor: 'rgba(252, 165, 165, 0.2)',
                    borderDash: [5, 5], 
                    data: [ {x:0, y:1}, {x:1500, y:10}, {x:1800, y:1}, {x:2200, y:50}, {x:2800, y:55}, {x:3100, y:100}, {x:3300, y:150}, {x:3500, y:152}, {x:3500, y:1} ]
                },
                {
                    label: 'é«˜xx',
                    borderColor: '#84cc16', 
                    backgroundColor: 'rgba(132, 204, 22, 0.2)',
                    borderDash: [5, 5],
                    data: [ {x:0, y:1}, {x:800, y:3}, {x:1200, y:5}, {x:2000, y:1}, {x:2100, y:50}, {x:2500, y:52}, {x:3000, y:58}, {x:3100, y:105}, {x:3700, y:110}, {x:3800, y:1} ]
                },
                {
                    label: 'é™³xx',
                    borderColor: '#c084fc', 
                    backgroundColor: 'rgba(192, 132, 252, 0.2)',
                    borderDash: [5, 5],
                    data: [ {x:2300, y:1}, {x:2350, y:52}, {x:2800, y:56}, {x:3100, y:110}, {x:3600, y:105}, {x:3700, y:150}, {x:4500, y:150}, {x:4800, y:152}, {x:4850, y:108}, {x:5100, y:105}, {x:5100, y:1} ]
                },
                {
                    label: 'æ—xx',
                    borderColor: '#fde047', 
                    backgroundColor: 'rgba(253, 224, 71, 0.2)',
                    borderDash: [5, 5],
                    data: [ {x:2000, y:1}, {x:2200, y:50}, {x:3000, y:51}, {x:3100, y:50}, {x:3800, y:53}, {x:4000, y:55}, {x:4700, y:58}, {x:4750, y:1}, {x:4800, y:53}, {x:5400, y:51}, {x:5500, y:55}, {x:5500, y:1} ]
                }
            ]
        };
        /** ================= ç³»çµ±è‡ªå‹•ç”Ÿæˆè³‡æ–™å€å¡ŠçµæŸ ================= */

        // å…±ç”¨è¨­å®š
        const bgColors = [chartData.colors.science, chartData.colors.tech, chartData.colors.eng, chartData.colors.art, chartData.colors.math];
        Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
        Chart.defaults.color = '#94a3b8'; 
        Chart.defaults.scale.grid.color = '#f1f5f9'; 

        const tooltipOptions = {
            backgroundColor: 'rgba(15, 23, 42, 0.95)', 
            titleFont: { size: 14, family: "'Noto Sans TC', sans-serif", weight: 'bold' },
            bodyFont: { size: 13, family: "'Noto Sans TC', sans-serif" },
            padding: 12,
            cornerRadius: 8,
            boxPadding: 6
        };

        // ==========================================
        // 0. å½ˆçª—èªªæ˜é‚è¼¯
        // ==========================================
        const modalData = {
            'pie': {
                title: 'èƒ½åŠ›çµ„æˆ (åœ“é¤…åœ–)',
                content: 'æ­¤åœ–è¡¨å‘ˆç¾å­¸ç”Ÿåœ¨ã€Œç§‘å­¸ã€æŠ€è¡“ã€å·¥ç¨‹ã€è—è¡“ã€æ•¸å­¸ã€äº”å€‹é ˜åŸŸçš„æ•´é«”æ¯”ä¾‹çµ„æˆã€‚å¯¦å¿ƒçš„è‰²å¡Šä»£è¡¨å­¸ç”Ÿçš„å¯¦éš›è¡¨ç¾ï¼Œèƒ½ç›´è§€çœ‹å‡ºå­¸ç”Ÿåœ¨å“ªå€‹é ˜åŸŸæŠ•å…¥æœ€å¤šã€‚'
            },
            'radar': {
                title: 'èƒ½åŠ›å½¢ç‹€å·®ç•° (é›·é”åœ–)',
                content: 'å°‡ã€Œå­¸ç”Ÿçš„å¯¦éš›è¡¨ç¾ã€èˆ‡ã€Œèª²ç¨‹è¨­å®šçš„åŸºæº–ã€é€²è¡Œå½¢ç‹€ä¸Šçš„ç–ŠåŠ å°æ¯”ã€‚<br><br><span class="inline-block w-3 h-3 bg-emerald-200 border border-emerald-400 mr-1"></span> å¯¦å¿ƒè‰²å¡Šä»£è¡¨å­¸ç”Ÿçš„å¯¦éš›è¡¨ç¾ã€‚<br><span class="inline-block w-3 h-0 border-t-2 border-dashed border-slate-300 mr-1 align-middle"></span> è™›ç·šæ¡†ä»£è¡¨èª²ç¨‹åŸºæº–ï¼Œè—‰æ­¤è©•ä¼°èƒ½åŠ›ç™¼å±•æ˜¯å¦å‡è¡¡ã€‚'
            },
            'timeline': {
                title: 'æ“ä½œæ™‚é–“ç´€éŒ„',
                content: 'è¨˜éŒ„å­¸ç”Ÿåœ¨ä¸åŒéšæ®µï¼ˆæ•™æã€é€²éšä¸€ï½ä¸‰ï¼‰çš„æ“ä½œæ­·ç¨‹ã€‚æ‚¨å¯é»æ“Šä¸Šæ–¹æŒ‰éˆ•å–®ç¨èšç„¦ç‰¹å®šéšæ®µã€‚<br><br>ğŸ’¡ <b>æç¤ºï¼š</b>åœ–è¡¨ä¸­çš„æ˜Ÿæ˜Ÿåœ–ç¤º (â­ï¸)ï¼Œä»£è¡¨è©²å­¸ç”Ÿåœ¨è©²éšæ®µé”æˆçš„ã€Œæœ€é«˜å®Œæˆé»ã€ã€‚'
            }
        };

        const infoModal = document.getElementById('infoModal');
        const infoModalContent = document.getElementById('infoModalContent');
        const infoModalTitle = document.getElementById('infoModalTitle');
        const infoModalBody = document.getElementById('infoModalBody');

        function openInfoModal(type) {
            infoModalTitle.innerHTML = modalData[type].title;
            infoModalBody.innerHTML = modalData[type].content;
            
            infoModal.classList.remove('hidden');
            void infoModal.offsetWidth; // è§¸ç™¼é‡ç¹ªä»¥å•Ÿç”¨å‹•ç•«
            infoModal.classList.remove('opacity-0');
            infoModalContent.classList.remove('scale-95');
        }

        function closeInfoModal() {
            infoModal.classList.add('opacity-0');
            infoModalContent.classList.add('scale-95');
            setTimeout(() => {
                infoModal.classList.add('hidden');
            }, 300); // ç­‰å¾…å‹•ç•«çµæŸ
        }

        // ==========================================
        // 1. åœ“é¤…åœ– (Pie)
        // ==========================================
        new Chart(document.getElementById('pieAreaChart'), {
            type: 'pie', 
            data: {
                labels: chartData.labels,
                datasets: [
                    {
                        label: 'å¯¦éš›è¡¨ç¾',
                        data: chartData.studentData,
                        backgroundColor: bgColors,
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        hoverOffset: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
                    tooltip: tooltipOptions
                }
            }
        });

        // ==========================================
        // 2. é›·é”å°æ¯”åœ–
        // ==========================================
        new Chart(document.getElementById('radarChart'), {
            type: 'radar',
            data: {
                labels: chartData.labels,
                datasets: [
                    {
                        label: 'å¯¦éš›è¡¨ç¾',
                        data: chartData.studentData,
                        backgroundColor: 'rgba(52, 211, 153, 0.2)', 
                        borderColor: '#34d399',
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#34d399',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        borderWidth: 2.5
                    },
                    {
                        label: 'åŸºæº–è¨­å®š',
                        data: chartData.baseData,
                        backgroundColor: 'transparent',
                        borderColor: '#cbd5e1', 
                        borderDash: [5, 5],
                        pointBackgroundColor: '#cbd5e1',
                        pointRadius: 2,
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8 } },
                    tooltip: tooltipOptions
                },
                scales: {
                    r: { 
                        min: 0, max: 5, 
                        ticks: { stepSize: 1, backdropColor: 'transparent', display: false }, 
                        grid: { color: '#f1f5f9' },
                        angleLines: { color: '#f1f5f9' },
                        pointLabels: { font: { size: 13, weight: '500' }, color: '#64748b' }
                    }
                }
            }
        });

        // ==========================================
        // 3. éšæ®µå€åŸŸèˆ‡æŠ˜ç·šåœ–
        // ==========================================
        const activeZones = { zone1: true, zone2: true, zone3: true, zone4: true };
        const zoneConfig = [
            { id: 'zone1', min: 1, max: 50, label: 'æ•™æå€', color: 'rgba(241, 245, 249, 0.7)', textColor: '#94a3b8' },
            { id: 'zone2', min: 51, max: 100, label: 'é€²éšä¸€', color: 'rgba(224, 242, 254, 0.6)', textColor: '#38bdf8' },
            { id: 'zone3', min: 101, max: 150, label: 'é€²éšäºŒ', color: 'rgba(220, 252, 231, 0.6)', textColor: '#34d399' },
            { id: 'zone4', min: 151, max: 200, label: 'é€²éšä¸‰', color: 'rgba(254, 226, 226, 0.6)', textColor: '#fb7185' }
        ];

        chartData.timeLineDatasets.forEach(ds => {
            ds.lastPoints = [];
            for (let z = 1; z <= 4; z++) {
                let min = (z === 1) ? 1 : (z - 1) * 50 + 1;
                let max = z * 50;
                
                let crossIndex = ds.data.findIndex(pt => pt.y > max);
                let limit = crossIndex !== -1 ? crossIndex : ds.data.length;
                
                let bestIdx = -1;
                let bestY = -1;
                
                for (let i = 0; i < limit; i++) {
                    let pt = ds.data[i];
                    if (pt.y >= min && pt.y <= max) {
                        if (pt.y >= bestY) {
                            bestY = pt.y;
                            bestIdx = i;
                        }
                    }
                }
                
                // èµ·é»æ”¹ç‚º 1 å¾Œï¼Œåˆ¤æ–·æ˜¯å¦ç‚ºæœ‰æ•ˆè¨˜éŒ„
                if (bestIdx !== -1 && bestY > 1) {
                    ds.lastPoints.push(bestIdx);
                }
            }
        });

        const horizontalZonePlugin = {
            id: 'horizontalZones',
            beforeDraw: (chart) => {
                const { ctx, chartArea: { top, bottom, left, right }, scales: { y } } = chart;
                ctx.save();
                
                zoneConfig.forEach(zone => {
                    const yTop = y.getPixelForValue(zone.max);
                    const yBottom = y.getPixelForValue(zone.min);
                    
                    const drawTop = Math.max(top, yTop);
                    const drawBottom = Math.min(bottom, yBottom);
                    
                    if (drawBottom > drawTop) {
                        ctx.fillStyle = zone.color;
                        ctx.fillRect(left, drawTop, right - left, drawBottom - drawTop);
                        
                        ctx.fillStyle = zone.textColor;
                        ctx.font = 'bold 13px "Noto Sans TC"';
                        ctx.textAlign = 'right';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(zone.label, right - 15, (drawTop + drawBottom) / 2);
                    }
                });
                ctx.restore();
            }
        };

        const lineDatasets = chartData.timeLineDatasets.map((ds) => ({
            label: ds.label,
            data: ds.data,
            borderColor: ds.borderColor,
            borderDash: ds.borderDash,
            borderWidth: 2.5,
            tension: 0, 
            stepped: false,
            // ç‚ºäº†ã€Œä¸è¦å‡ºç¾å…¶ä»–å€åŸŸç•«é¢ã€ï¼Œå–æ¶ˆæº¢å‡ºç•«å¸ƒé¡¯ç¤º (æ¢å¾©åš´æ ¼è£åˆ‡)
            clip: true, 
            
            pointRadius: (ctx) => {
                if(ctx.dataIndex === undefined) return 2;
                return ds.lastPoints.includes(ctx.dataIndex) ? 8 : 2;
            },
            pointStyle: (ctx) => {
                if(ctx.dataIndex === undefined) return 'circle';
                return ds.lastPoints.includes(ctx.dataIndex) ? 'star' : 'circle';
            },
            pointBackgroundColor: (ctx) => {
                if(ctx.dataIndex === undefined) return '#fff';
                return ds.lastPoints.includes(ctx.dataIndex) ? ds.borderColor : '#fff';
            },
            pointBorderColor: (ctx) => {
                return ds.borderColor;
            },
            pointBorderWidth: 2
        }));

        const timeLineChart = new Chart(document.getElementById('timeLineChart'), {
            type: 'line',
            data: { datasets: lineDatasets },
            plugins: [horizontalZonePlugin],
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'nearest', 
                    intersect: false
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        ...tooltipOptions,
                        callbacks: {
                            title: (items) => `æ™‚é–“: ${items[0].parsed.x}`,
                            label: (context) => {
                                const ds = chartData.timeLineDatasets[context.datasetIndex];
                                const isLast = ds.lastPoints.includes(context.dataIndex);
                                const mark = isLast ? ' â­ (æœ€é«˜å®Œæˆé»)' : '';
                                return ` ${context.dataset.label}: ${context.parsed.y}${mark}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        min: 0,
                        max: chartData.timeLineXMax,
                        ticks: { stepSize: 1000, color: '#94a3b8', font: {family: "'Noto Sans TC', sans-serif"} },
                        grid: { color: '#f8fafc', drawBorder: false },
                        title: { display: true, text: 'æ“ä½œæ™‚é–“è»¸ (ms/s)', color: '#cbd5e1', font: {size: 13} }
                    },
                    y: {
                        min: 1, // èµ·é»æ”¹ç‚º 1
                        max: 200, 
                        // ç§»é™¤ stepSize è®“ Y è»¸çš„åˆ»åº¦æ›´è‡ªç„¶é…åˆåš´æ ¼çš„é‚Šç•Œ
                        ticks: { color: '#94a3b8', font: {family: "'Noto Sans TC', sans-serif"} },
                        grid: { color: '#f1f5f9', drawBorder: false },
                    }
                }
            }
        });

        // ==========================================
        // 4. UI äº’å‹•èˆ‡åš´æ ¼ç¸®æ”¾é‚è¼¯
        // ==========================================
        const zoneCheckboxes = document.querySelectorAll('.zone-toggle');
        const datasetCheckboxes = document.querySelectorAll('.dataset-toggle');
        const showAllBtn = document.getElementById('showAllBtn');

        function updateYAxisZoom() {
            let activeMins = [];
            let activeMaxs = [];
            zoneConfig.forEach(zone => {
                if (activeZones[zone.id]) {
                    activeMins.push(zone.min);
                    activeMaxs.push(zone.max);
                }
            });
            
            // åš´æ ¼è£åˆ‡ï¼šè¦–åœ–å®Œå…¨è²¼é½Šé¸å–çš„å€åŸŸé‚Šç•Œï¼Œä¸å†é ç•™ Paddingï¼Œå¯¦ç¾ä¸çœ‹åˆ°å…¶ä»–ç•«é¢
            if (activeMins.length > 0) {
                timeLineChart.options.scales.y.min = Math.min(...activeMins);
                timeLineChart.options.scales.y.max = Math.max(...activeMaxs);
            } else {
                timeLineChart.options.scales.y.min = 1;
                timeLineChart.options.scales.y.max = 200;
            }
            timeLineChart.update();
        }

        // ã€æ™ºæ…§é»é¸é‚è¼¯ã€‘
        zoneCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('click', function(e) {
                e.preventDefault();
                
                const clickedVal = this.value;
                const checkedCount = Object.values(activeZones).filter(v => v).length;
                
                if (checkedCount === 4) {
                    Object.keys(activeZones).forEach(k => activeZones[k] = false);
                    activeZones[clickedVal] = true;
                } else {
                    activeZones[clickedVal] = !activeZones[clickedVal];
                }
                
                if (Object.values(activeZones).filter(v => v).length === 0) {
                    Object.keys(activeZones).forEach(k => activeZones[k] = true);
                }
                
                zoneCheckboxes.forEach(cb => cb.checked = activeZones[cb.value]);
                updateYAxisZoom();
            });
        });

        datasetCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const datasetIndex = parseInt(this.value);
                timeLineChart.setDatasetVisibility(datasetIndex, this.checked);
                timeLineChart.update();
            });
        });

        showAllBtn.addEventListener('click', () => {
            datasetCheckboxes.forEach(cb => { cb.checked = true; });
            chartData.timeLineDatasets.forEach((_, index) => {
                timeLineChart.setDatasetVisibility(index, true);
            });
            
            zoneCheckboxes.forEach(cb => { 
                cb.checked = true; 
                activeZones[cb.value] = true;
            });
            updateYAxisZoom();
        });

    </script>
</body>
</html>