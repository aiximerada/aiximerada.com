<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>個人資料設定</title>
  
  <!-- 載入 Tailwind CSS 來處理樣式，並設定支援暗黑模式 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class', // 啟用基於 class 的暗黑模式
    }
  </script>
  
  <!-- 載入 React 與 ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  
  <!-- 載入 Babel 以便在瀏覽器中編譯 JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-[#121212] font-sans antialiased transition-colors duration-300 overflow-hidden">
  
  <!-- React App 將會渲染在這裡 -->
  <div id="root"></div>

  <!-- React 程式碼區塊 -->
  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // --- 圖示元件 ---
    const IconBase = ({ className, strokeWidth, children }) => (
      <svg className={className} strokeWidth={strokeWidth || 2} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round">
        {children}
      </svg>
    );

    const Home = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>;
    const UserSquare2 = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="12" cy="10" r="3"/><path d="M7 21v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2"/></IconBase>;
    const ChevronDown = (props) => <IconBase {...props}><path d="m6 9 6 6 6-6"/></IconBase>;
    const ChevronRight = (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>;
    const Baby = (props) => <IconBase {...props}><path d="M9 12h.01"/><path d="M15 12h.01"/><path d="M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5"/><path d="M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1"/></IconBase>;
    const Camera = (props) => <IconBase {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></IconBase>;
    const GraduationCap = (props) => <IconBase {...props}><path d="M21.42 10.922a2 2 0 0 0-.019-3.838L12.83 4.3a2 2 0 0 0-1.66 0L2.6 7.08a2 2 0 0 0 0 3.832l8.57 3.698a2 2 0 0 0 1.66 0z"/><path d="M22 10v6"/><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"/></IconBase>;
    const User = (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
    const ImageIcon = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconBase>;
    const Moon = (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconBase>;
    const Sun = (props) => <IconBase {...props}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconBase>;
    const Coins = (props) => <IconBase {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></IconBase>;
    const ExternalLink = (props) => <IconBase {...props}><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></IconBase>;
    const Menu = (props) => <IconBase {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconBase>;
    const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
    const Package = (props) => <IconBase {...props}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></IconBase>;
    const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></IconBase>;

    // --- 圖片壓縮功能函式 ---
    const compressImage = (file, maxWidth = 1000, maxHeight = 1000, quality = 0.8) => {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (event) => {
          const img = new Image();
          img.src = event.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;

            if (width > height) {
              if (width > maxWidth) {
                height = Math.round((height * maxWidth) / width);
                width = maxWidth;
              }
            } else {
              if (height > maxHeight) {
                width = Math.round((width * maxHeight) / height);
                height = maxHeight;
              }
            }
            
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            resolve(canvas.toDataURL('image/jpeg', quality));
          };
        };
      });
    };

    // --- 主要的應用程式元件 ---
    function App() {
      // 狀態設定
      const [isDarkMode, setIsDarkMode] = useState(false);
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);
      const [activeMenu, setActiveMenu] = useState('個人資料');
      const [isParentMenuOpen, setIsParentMenuOpen] = useState(true);

      useEffect(() => {
        if (isDarkMode) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }, [isDarkMode]);

      // 取得今天的日期 (用於限制生日不可選擇未來)
      const maxDate = useMemo(() => {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }, []);

      // 表單資料狀態 (新增 teachingAidStatus 教具狀態)
      const [formData, setFormData] = useState({
        name: '王大明',
        role: '家長',
        birthday: '1985-05-15',
        email: 'parent@example.com',
        phone: '0912345678',
        gender: '男',
        country: '台灣',
        region: '台北市',
        address: '信義區市府路1號',
        teachingAidStatus: '動力教具',
        points: 1250
      });

      const [age, setAge] = useState('');
      const [avatarPreview, setAvatarPreview] = useState('https://i.pravatar.cc/150?img=11');
      const [bgPreview, setBgPreview] = useState('https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=2000&auto=format&fit=crop');

      // 學習歷程下拉狀態
      const [isHistoryOpen, setIsHistoryOpen] = useState(false);
      const [openLevel, setOpenLevel] = useState(null);

      const avatarInputRef = useRef(null);
      const bgInputRef = useRef(null);

      // 自動計算年齡邏輯
      useEffect(() => {
        if (formData.birthday) {
          const today = new Date();
          const birthDate = new Date(formData.birthday);
          let currentAge = today.getFullYear() - birthDate.getFullYear();
          const m = today.getMonth() - birthDate.getMonth();
          if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            currentAge--;
          }
          setAge(currentAge >= 0 ? currentAge : 0);
        } else {
          setAge('');
        }
      }, [formData.birthday]);

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
      };

      const handleImageUpload = async (e, type) => {
        const file = e.target.files[0];
        if (file) {
          try {
            const compressedImageUrl = await compressImage(file);
            if (type === 'avatar') setAvatarPreview(compressedImageUrl);
            else if (type === 'background') setBgPreview(compressedImageUrl);
          } catch (error) {
            console.error("圖片壓縮失敗", error);
            alert("圖片處理發生錯誤，請重試！");
          }
        }
      };

      // 糖果色系：分配給各級別使用
      const livelyThemes = [
        { main: 'bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-300', border: 'border-pink-300 dark:border-pink-800', hover: 'hover:bg-pink-200 dark:hover:bg-pink-900/60' },
        { main: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300', border: 'border-amber-300 dark:border-amber-800', hover: 'hover:bg-amber-200 dark:hover:bg-amber-900/60' },
        { main: 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300', border: 'border-emerald-300 dark:border-emerald-800', hover: 'hover:bg-emerald-200 dark:hover:bg-emerald-900/60' },
        { main: 'bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300', border: 'border-sky-300 dark:border-sky-800', hover: 'hover:bg-sky-200 dark:hover:bg-sky-900/60' },
        { main: 'bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-300', border: 'border-violet-300 dark:border-violet-800', hover: 'hover:bg-violet-200 dark:hover:bg-violet-900/60' }
      ];

      // 動態產生 1 到 16 級的學習歷程資料 (加入 Emoji 更可愛)
      const mockLevels = useMemo(() => {
        const courseNames = ['🏀 投籃機', '🎡 摩天輪', '🗜️ 伸縮夾子', '🏎️ 皂飛車', '🚲 獨輪車', '🏁 賽車'];
        return Array.from({ length: 16 }, (_, i) => ({
          level: i + 1,
          levelName: `✨ 第 ${i + 1} 級挑戰`,
          theme: livelyThemes[i % livelyThemes.length],
          courses: courseNames.map((name, index) => ({
            id: `lvl-${i + 1}-course-${index + 1}`,
            courseName: name,
            attended: Math.random() > 0.3
          }))
        }));
      }, []);

      const toggleLevel = (levelNum) => {
        setOpenLevel(openLevel === levelNum ? null : levelNum);
      };

      return (
        <div className="flex h-screen w-full font-sans bg-gray-100 dark:bg-[#121212] transition-colors duration-300">
          
          {/* 手機版：側邊欄背景遮罩 */}
          {isSidebarOpen && (
            <div 
              className="fixed inset-0 bg-black/60 z-40 md:hidden transition-opacity backdrop-blur-sm"
              onClick={() => setIsSidebarOpen(false)}
            />
          )}

          {/* 左側選單 (側邊欄) */}
          <div className={`fixed md:static inset-y-0 left-0 w-64 md:w-64 bg-[#242424] dark:bg-black text-gray-300 flex-shrink-0 flex flex-col shadow-2xl z-50 transform transition-transform duration-300 ease-in-out ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
            
            {/* 側邊欄 Header */}
            <div className="p-6 flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-full overflow-hidden border-2 border-transparent relative bg-[#FFB199] flex-shrink-0">
                  <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=FFB199" alt="Profile" className="w-full h-full object-cover"/>
                </div>
                <span className="text-white text-xl font-medium tracking-wider">家長</span>
              </div>
              <button className="md:hidden text-gray-400 hover:text-white p-1" onClick={() => setIsSidebarOpen(false)}>
                <X className="w-6 h-6" />
              </button>
            </div>

            <div className="px-6 mb-4">
              <hr className="border-[#4A4A4A]" />
            </div>

            <nav className="flex-1 px-4 space-y-2 overflow-y-auto">
              <button 
                onClick={() => { setActiveMenu('後台首頁'); setIsSidebarOpen(false); }}
                className={`w-full flex items-center gap-4 px-4 py-3 rounded-lg transition-colors ${activeMenu === '後台首頁' ? 'text-[#68C1C6]' : 'hover:bg-[#333333]'}`}
              >
                <Home className="w-7 h-7" strokeWidth={2} />
                <span className="text-[17px] font-medium tracking-wide">後台首頁</span>
              </button>

              <button 
                onClick={() => { setActiveMenu('個人資料'); setIsSidebarOpen(false); }}
                className={`w-full flex items-center gap-4 px-4 py-3 rounded-lg transition-colors ${activeMenu === '個人資料' ? 'text-[#68C1C6]' : 'hover:bg-[#333333]'}`}
              >
                <UserSquare2 className="w-7 h-7" strokeWidth={2} />
                <span className="text-[17px] font-medium tracking-wide">個人資料</span>
              </button>

              <div className="pt-2">
                <button 
                  onClick={() => setIsParentMenuOpen(!isParentMenuOpen)}
                  className="w-full flex items-center gap-2 px-4 py-3 hover:bg-[#333333] rounded-lg transition-colors text-gray-400"
                >
                  <span className="text-[16px] tracking-wide">家長</span>
                  <ChevronDown className={`w-4 h-4 transition-transform ${isParentMenuOpen ? '' : '-rotate-90'}`} />
                </button>
                
                <div className={`overflow-hidden transition-all duration-300 ${isParentMenuOpen ? 'max-h-40 opacity-100' : 'max-h-0 opacity-0'}`}>
                  <div className="pl-6 pr-4 py-1">
                    <button className="w-full flex items-center gap-4 px-4 py-3 rounded-lg hover:bg-[#333333] transition-colors">
                      <Baby className="w-7 h-7" strokeWidth={2} />
                      <span className="text-[17px] font-medium tracking-wide">小孩資訊</span>
                    </button>
                  </div>
                </div>
              </div>
            </nav>
          </div>

          {/* 右側主要內容區 */}
          <div className="flex-1 flex flex-col min-w-0 h-screen overflow-y-auto overflow-x-hidden">
            
            {/* 手機版：頂部導覽列 */}
            <div className="md:hidden flex items-center justify-between p-4 bg-white dark:bg-[#1e1e1e] border-b border-gray-200 dark:border-gray-800 sticky top-0 z-30 transition-colors shadow-sm">
              <div className="flex items-center gap-3">
                <button 
                  onClick={() => setIsSidebarOpen(true)}
                  className="text-gray-600 dark:text-gray-300 p-1 hover:bg-gray-100 dark:hover:bg-[#2a2a2a] rounded-lg transition-colors"
                >
                  <Menu className="w-6 h-6" />
                </button>
                <span className="font-bold text-lg text-gray-800 dark:text-gray-100">個人資料設定</span>
              </div>
              <button 
                onClick={() => setIsDarkMode(!isDarkMode)}
                className="p-2 rounded-full bg-gray-100 dark:bg-[#2a2a2a] text-gray-600 dark:text-gray-300"
              >
                {isDarkMode ? <Sun className="w-5 h-5 text-yellow-500" /> : <Moon className="w-5 h-5 text-indigo-500" />}
              </button>
            </div>

            <div className="max-w-5xl mx-auto p-4 sm:p-6 md:p-8 w-full">
              
              {/* 桌面版：頂部標題區 & 夜晚模式切換按鈕 */}
              <div className="hidden md:flex justify-between items-center mb-8">
                <div>
                  <h1 className="text-3xl font-bold text-gray-800 dark:text-gray-100 transition-colors">個人資料設定</h1>
                  <p className="text-gray-500 dark:text-gray-400 mt-2 transition-colors">檢視與編輯您的個人基本資訊</p>
                </div>
                
                <button 
                  onClick={() => setIsDarkMode(!isDarkMode)}
                  className="p-3 rounded-full bg-white dark:bg-[#1e1e1e] border border-gray-200 dark:border-gray-800 text-gray-600 dark:text-gray-300 shadow-sm hover:shadow-md transition-all active:scale-95"
                  title={isDarkMode ? "切換為白天模式" : "切換為夜晚模式"}
                >
                  {isDarkMode ? <Sun className="w-6 h-6 text-yellow-500" /> : <Moon className="w-6 h-6 text-indigo-500" />}
                </button>
              </div>

              {/* 資料卡片區 */}
              <div className="bg-white dark:bg-[#1e1e1e] rounded-3xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 sm:mb-8 transition-colors">
                
                {/* 背景卡片與大頭照區塊 */}
                <div className="relative h-40 sm:h-48 md:h-64 group">
                  <img 
                    src={bgPreview} 
                    alt="Background" 
                    className="w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-90"
                  />
                  <div className="absolute inset-0 bg-black/10 group-hover:bg-black/20 transition-colors"></div>
                  
                  <button 
                    onClick={() => bgInputRef.current?.click()}
                    className="absolute top-3 right-3 sm:top-4 sm:right-4 bg-white/80 dark:bg-black/50 backdrop-blur-sm hover:bg-white dark:hover:bg-black text-gray-700 dark:text-gray-200 px-3 py-1.5 sm:px-4 sm:py-2 rounded-full shadow flex items-center gap-2 text-xs sm:text-sm font-medium transition-all"
                  >
                    <ImageIcon className="w-4 h-4" />
                    <span className="hidden sm:inline">更改封面</span>
                    <span className="sm:hidden">封面</span>
                  </button>
                  <input type="file" ref={bgInputRef} className="hidden" accept="image/*" onChange={(e) => handleImageUpload(e, 'background')} />

                  <div className="absolute -bottom-10 sm:-bottom-12 md:-bottom-16 left-4 sm:left-8 md:left-12 group/avatar z-10">
                    <div className="relative w-20 h-20 sm:w-28 sm:h-28 md:w-32 md:h-32 rounded-full border-4 border-white dark:border-[#1e1e1e] shadow-lg overflow-hidden bg-white dark:bg-[#1e1e1e] transition-colors">
                      <img src={avatarPreview} alt="Avatar" className="w-full h-full object-cover"/>
                      <div 
                        onClick={() => avatarInputRef.current?.click()}
                        className="absolute inset-0 bg-black/40 flex flex-col items-center justify-center opacity-0 group-hover/avatar:opacity-100 cursor-pointer transition-opacity"
                      >
                        <Camera className="w-6 h-6 sm:w-8 sm:h-8 text-white mb-1" />
                        <span className="text-white text-[10px] sm:text-xs font-medium">更換照片</span>
                      </div>
                    </div>
                    <input type="file" ref={avatarInputRef} className="hidden" accept="image/*" onChange={(e) => handleImageUpload(e, 'avatar')} />
                  </div>
                </div>

                {/* 表單輸入區塊 */}
                <div className="pt-14 sm:pt-20 md:pt-24 pb-6 sm:pb-8 px-4 sm:px-8 md:px-12">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-5 sm:gap-y-6">
                    
                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                        <User className="w-4 h-4 text-gray-500" /> 姓名
                      </label>
                      <input type="text" name="name" value={formData.name} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all" placeholder="請輸入姓名" />
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">身份別</label>
                      <select name="role" value={formData.role} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all appearance-none">
                        <option value="學生">學生</option>
                        <option value="家長">家長</option>
                        <option value="老師">老師</option>
                        <option value="行政">行政</option>
                      </select>
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                        Email <span className="text-xs text-red-500 font-normal">(不可更動)</span>
                      </label>
                      <input type="email" name="email" value={formData.email} disabled className="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#222222] text-gray-500 cursor-not-allowed outline-none" />
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">電話</label>
                      <input type="tel" name="phone" value={formData.phone} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all" placeholder="請輸入聯絡電話" />
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">生日</label>
                      <input type="date" name="birthday" max={maxDate} value={formData.birthday} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all" />
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">年齡</label>
                      <div className="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#222222] flex items-center gap-2">
                        <span className="font-medium text-lg text-gray-800 dark:text-gray-300">{age}</span> 
                        <span className="text-gray-600 dark:text-gray-400">歲</span>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">性別</label>
                      <select name="gender" value={formData.gender} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all appearance-none">
                        <option value="男">男</option>
                        <option value="女">女</option>
                        <option value="其他">其他</option>
                      </select>
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">國家</label>
                      <select name="country" value={formData.country} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all appearance-none">
                        <option value="台灣">台灣</option>
                        <option value="日本">日本</option>
                        <option value="韓國">韓國</option>
                        <option value="美國">美國</option>
                        <option value="其他">其他</option>
                      </select>
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">地區</label>
                      <select name="region" value={formData.region} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all appearance-none">
                        <option value="基隆市">基隆市</option>
                        <option value="台北市">台北市</option>
                        <option value="新北市">新北市</option>
                        <option value="桃園市">桃園市</option>
                        <option value="新竹市">新竹市</option>
                        <option value="新竹縣">新竹縣</option>
                        <option value="台中市">台中市</option>
                        <option value="台南市">台南市</option>
                        <option value="高雄市">高雄市</option>
                        <option value="其他">其他</option>
                      </select>
                    </div>

                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300">地址</label>
                      <input type="text" name="address" value={formData.address} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-[#68C1C6] focus:border-[#68C1C6] outline-none transition-all" placeholder="請輸入詳細地址" />
                    </div>

                    {/* 新增：教具狀態 */}
                    <div className="space-y-2">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                        <Package className="w-4 h-4 text-indigo-500" /> 教具狀態
                      </label>
                      <select name="teachingAidStatus" value={formData.teachingAidStatus} onChange={handleInputChange} className="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#2a2a2a] text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 outline-none transition-all appearance-none font-medium">
                        <option value="充電教具">🔋 充電教具</option>
                        <option value="動力教具">⚙️ 動力教具</option>
                        <option value="租借">📦 租借</option>
                      </select>
                    </div>
                    
                    {/* 點數 (不可修改) */}
                    <div className="space-y-2 md:col-span-1">
                      <label className="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                        <Coins className="w-5 h-5 text-yellow-500" />
                        持有點數 <span className="text-xs text-red-500 font-normal">(不可更動)</span>
                      </label>
                      <input type="number" name="points" value={formData.points} disabled className="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#222222] text-yellow-600 dark:text-yellow-500 font-bold text-lg cursor-not-allowed outline-none" />
                    </div>

                  </div>
                  
                  <div className="mt-8 flex justify-end">
                    <button className="w-full md:w-auto bg-[#68C1C6] hover:bg-[#5bb2b8] text-white px-8 py-3 md:py-2.5 rounded-xl font-medium shadow-md shadow-[#68C1C6]/40 transition-all transform active:scale-95 text-center">
                      儲存設定
                    </button>
                  </div>

                </div>
              </div>

              {/* 🌈 學習歷程區塊 (可愛活潑版) */}
              <div className="mb-12">
                
                {/* 夢幻漸層標題按鈕 */}
                <button 
                  onClick={() => setIsHistoryOpen(!isHistoryOpen)}
                  className="w-full px-5 sm:px-8 py-5 sm:py-6 flex items-center justify-between rounded-3xl bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 text-white shadow-lg shadow-purple-500/30 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 active:scale-[0.98]"
                >
                  <div className="flex items-center gap-3">
                    <div className="p-2.5 bg-white/20 backdrop-blur-sm rounded-2xl">
                      <Sparkles className="w-6 h-6 sm:w-7 sm:h-7 text-white" />
                    </div>
                    <span className="text-xl sm:text-2xl font-bold tracking-wide">學習歷程記錄</span>
                  </div>
                  <ChevronDown className={`w-6 h-6 sm:w-8 sm:h-8 text-white/90 transition-transform duration-500 ${isHistoryOpen ? 'rotate-180' : ''}`} />
                </button>
                
                {/* 下拉層次外框 */}
                <div className={`transition-all duration-500 ease-in-out origin-top ${isHistoryOpen ? 'max-h-[3000px] opacity-100 mt-4' : 'max-h-0 opacity-0 mt-0 overflow-hidden'}`}>
                  
                  {/* 使用虛線與柔和底色作為外容器 */}
                  <div className="p-4 sm:p-6 bg-white dark:bg-[#1e1e1e] rounded-3xl border-4 border-dashed border-pink-200 dark:border-pink-900/40 space-y-4">
                    
                    {mockLevels.map((lvl) => (
                      <div key={lvl.level} className="flex flex-col">
                        
                        {/* 彩色糖果級別按鈕 */}
                        <button
                          onClick={() => toggleLevel(lvl.level)}
                          className={`w-full px-5 sm:px-6 py-4 flex items-center justify-between rounded-2xl border-2 transition-all duration-300 transform active:scale-[0.98] ${lvl.theme.main} ${lvl.theme.border} ${lvl.theme.hover}`}
                        >
                          <span className="font-bold text-lg">{lvl.levelName}</span>
                          <ChevronRight className={`w-5 h-5 sm:w-6 sm:h-6 transition-transform duration-300 ${openLevel === lvl.level ? 'rotate-90' : ''}`} />
                        </button>

                        {/* 該級別底下的課程卡片 */}
                        <div className={`transition-all duration-300 ease-in-out overflow-hidden ${openLevel === lvl.level ? 'max-h-[1500px] mt-3' : 'max-h-0 mt-0'}`}>
                          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-2">
                            {lvl.courses.map((course) => (
                              <a 
                                key={course.id} 
                                href={`#course-${course.id}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="group relative flex flex-col p-5 bg-white dark:bg-[#252525] rounded-3xl border-2 border-transparent hover:border-pink-300 dark:hover:border-pink-600 shadow-sm hover:shadow-xl shadow-pink-100 dark:shadow-none hover:-translate-y-1 transition-all duration-300"
                              >
                                <div className="flex items-center justify-between mb-4">
                                  <span className="font-bold text-base sm:text-lg text-gray-700 dark:text-gray-200 group-hover:text-pink-500 dark:group-hover:text-pink-400 transition-colors">
                                    {course.courseName}
                                  </span>
                                  <div className="w-8 h-8 rounded-full bg-gray-50 dark:bg-[#1e1e1e] flex items-center justify-center group-hover:bg-pink-100 dark:group-hover:bg-pink-900/50 transition-colors">
                                    <ExternalLink className="w-4 h-4 text-gray-400 group-hover:text-pink-500 transition-colors" />
                                  </div>
                                </div>
                                
                                <div className="mt-auto">
                                  {/* 胖胖標籤 (Badge) 取代單調的紅綠燈號 */}
                                  {course.attended ? (
                                    <span className="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs sm:text-sm font-bold bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400">
                                      <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                      ✅ 已上課
                                    </span>
                                  ) : (
                                    <span className="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs sm:text-sm font-bold bg-rose-100 text-rose-600 dark:bg-rose-900/30 dark:text-rose-400">
                                      <span className="w-2 h-2 rounded-full bg-rose-500"></span>
                                      🔴 待上課
                                    </span>
                                  )}
                                </div>
                              </a>
                            ))}
                          </div>
                        </div>

                      </div>
                    ))}

                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>