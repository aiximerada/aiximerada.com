<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>物資補給站 - 啊吧啊吧</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg-deep: #050811; --suisei-cyan: #3bc6e4; --card-bg: rgba(13, 27, 51, 0.85); --text-glow: 0 0 8px rgba(59, 198, 228, 0.8); }
        body { font-family: 'Microsoft JhengHei', 'Consolas', monospace; background: radial-gradient(circle at center, #1a2c4e 0%, #050811 100%); color: #ecf0f1; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding-bottom: 80px; margin: 0; -webkit-tap-highlight-color: transparent; }
        .grid-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(59, 198, 228, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(59, 198, 228, 0.05) 1px, transparent 1px); background-size: 30px 30px; z-index: -2; pointer-events: none; }
        .container { width: 95%; max-width: 1200px; padding: 40px 20px; box-sizing: border-box;}
        
        .header-area { margin-bottom: 30px; text-align: center; position: relative; }
        h1 { color: var(--suisei-cyan); text-shadow: var(--text-glow); font-size: 2.2rem; margin: 0 0 10px 0; letter-spacing: 3px; text-transform: uppercase; }
        .back-link { position: absolute; left: 0; top: 10px; color: #666; text-decoration: none; font-size: 0.9rem; border: 1px solid #666; padding: 5px 15px; border-radius: 4px; transition: 0.3s; }
        .back-link:hover { color: var(--suisei-cyan); border-color: var(--suisei-cyan); box-shadow: var(--text-glow); }

        /* 商品網格 */
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; width: 100%; margin-bottom: 60px; }
        
        .product-card {
            background: var(--card-bg); border: 1px solid rgba(59, 198, 228, 0.3); border-radius: 15px;
            overflow: hidden; transition: 0.3s; position: relative; display: flex; flex-direction: column;
            touch-action: manipulation;
        }
        .product-card:hover { border-color: var(--suisei-cyan); box-shadow: 0 0 15px rgba(59, 198, 228, 0.2); transform: translateY(-5px); }
        
        .p-img-box { width: 100%; height: 200px; background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .p-img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .product-card:hover .p-img-box img { transform: scale(1.1); }
        
        .p-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .p-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; color: #fff; }
        .p-desc { font-size: 0.9rem; color: #888; margin-bottom: 15px; flex-grow: 1; }
        .p-price { font-size: 1.4rem; color: var(--suisei-cyan); font-weight: bold; margin-bottom: 15px; }
        
        .btn-add {
            width: 100%; padding: 10px; background: transparent; border: 1px solid var(--suisei-cyan); color: var(--suisei-cyan);
            font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-add:hover { background: var(--suisei-cyan); color: #000; }
        .btn-add:active { transform: scale(0.95); }

        /* 購物車懸浮按鈕 */
        .cart-float {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background: var(--suisei-cyan); border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(59, 198, 228, 0.5); cursor: pointer; z-index: 100; transition: 0.3s;
        }
        .cart-float:active { transform: scale(0.9); }
        .cart-icon { font-size: 1.5rem; color: #000; }
        .cart-count {
            position: absolute; top: -5px; right: -5px; background: #ff4444; color: #fff;
            width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; font-weight: bold; border: 2px solid #050811;
        }

        /* 購物車側邊欄 */
        .cart-sidebar {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 350px; height: 100%; background: #0b1021;
            border-left: 2px solid var(--suisei-cyan); z-index: 200; transition: 0.4s; padding: 20px;
            box-shadow: -10px 0 30px rgba(0,0,0,0.8); display: flex; flex-direction: column;
            box-sizing: border-box;
        }
        .cart-sidebar.open { right: 0; }
        
        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .cart-title { font-size: 1.2rem; font-weight: bold; color: var(--suisei-cyan); }
        .btn-close { background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; padding: 10px; }
        
        .cart-items { flex-grow: 1; overflow-y: auto; margin-bottom: 20px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
        .item-info { flex-grow: 1; }
        .item-name { font-size: 0.9rem; font-weight: bold; }
        .item-price { color: var(--suisei-cyan); font-size: 0.9rem; }
        .btn-remove { color: #ff4444; cursor: pointer; margin-left: 10px; padding: 10px; }

        .cart-footer { border-top: 1px solid #333; padding-top: 20px; }
        .total-price { font-size: 1.5rem; color: #fff; text-align: right; margin-bottom: 15px; font-weight: bold; }
        
        .btn-checkout {
            width: 100%; padding: 15px; background: #06c755; color: #fff; border: none; font-weight: bold;
            font-size: 1.1rem; cursor: pointer; margin-bottom: 10px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-checkout:hover { background: #05b34c; }
        .btn-checkout:active { transform: scale(0.98); }
        
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:150; display:none; backdrop-filter: blur(2px);}
        .overlay.active { display:block; }
    </style>
</head>
<body>
    <div class="grid-bg"></div>
    <div class="overlay" onclick="toggleCart()"></div>

    <div class="container">
        <div class="header-area">
            <a href="index.html" class="back-link">&lt; 退出商城</a>
            <h1 data-i18n="shop.pageTitle">SUPPLY DEPOT</h1>
            <p style="color:#888" data-i18n="shop.desc">手工皂與特製物資補給中心</p>
        </div>

        <div class="shop-grid" id="productGrid">
            </div>
    </div>

    <div class="cart-float" onclick="toggleCart()">
        <i class="fa-solid fa-cart-shopping cart-icon"></i>
        <div class="cart-count" id="cartCount">0</div>
    </div>

    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <div class="cart-title">物資清單</div>
            <button class="btn-close" onclick="toggleCart()">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div style="text-align:center; color:#666; margin-top:50px;">購物車是空的</div>
        </div>
        <div class="cart-footer">
            <div class="total-price">總計: NT$ <span id="cartTotal">0</span></div>
            
            <button class="btn-checkout" onclick="checkout()">
                <i class="fa-brands fa-line" style="font-size: 1.5rem;"></i> 
                送出訂單 (LINE)
            </button>
        </div>
    </div>

    <script src="js/content.js"></script>
    <script src="js/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // 模擬商品資料 (如有需要，可隨時在這裡新增或修改商品)
        const products = [
            { id: 1, name: "深空潔淨手工皂", price: 250, desc: "適合油性肌膚，帶有薄荷與茶樹清香。", img: "https://via.placeholder.com/300/0b1021/3bc6e4?text=SOAP-01" },
            { id: 2, name: "星雲保濕禮盒", price: 880, desc: "三入組，包含薰衣草、玫瑰與牛奶皂。", img: "https://via.placeholder.com/300/0b1021/f2c94c?text=GIFT-SET" },
            { id: 3, name: "反重力沐浴球", price: 150, desc: "丟入水中產生銀河般的氣泡效果。", img: "https://via.placeholder.com/300/0b1021/ff4444?text=BOMB-01" },
            { id: 4, name: "賽博機能洗髮餅", price: 320, desc: "固態洗髮精，環保且攜帶方便。", img: "https://via.placeholder.com/300/0b1021/00c851?text=SHAMPOO" }
        ];

        let cart = [];

        // 初始化
        window.addEventListener('load', () => {
            renderProducts();
        });

        function renderProducts() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = products.map(p => `
                <div class="product-card">
                    <div class="p-img-box"><img src="${p.img}" alt="${p.name}"></div>
                    <div class="p-info">
                        <div class="p-title">${p.name}</div>
                        <div class="p-desc">${p.desc}</div>
                        <div class="p-price">NT$ ${p.price}</div>
                        <button class="btn-add" onclick="addToCart(${p.id})">加入清單</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            cart.push(product);
            updateCartUI();
            
            // 簡單的動畫回饋
            const floatBtn = document.querySelector('.cart-float');
            floatBtn.style.transform = 'scale(1.2)';
            setTimeout(() => floatBtn.style.transform = 'scale(1)', 200);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
        }

        function updateCartUI() {
            const itemsContainer = document.getElementById('cartItems');
            const countBadge = document.getElementById('cartCount');
            const totalDisplay = document.getElementById('cartTotal');
            
            countBadge.innerText = cart.length;
            
            let total = 0;
            if (cart.length === 0) {
                itemsContainer.innerHTML = '<div style="text-align:center; color:#666; margin-top:50px;">購物車是空的</div>';
            } else {
                itemsContainer.innerHTML = cart.map((item, index) => {
                    total += item.price;
                    return `
                    <div class="cart-item">
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">NT$ ${item.price}</div>
                        </div>
                        <div class="btn-remove" onclick="removeFromCart(${index})"><i class="fa-solid fa-trash"></i></div>
                    </div>`;
                }).join('');
            }
            totalDisplay.innerText = total;
        }

        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('open');
            document.querySelector('.overlay').classList.toggle('active');
        }

        // --- 結帳邏輯：串接 LINE 官方帳號 ---
        function checkout() {
            if (cart.length === 0) {
                Swal.fire({ icon: 'warning', title: '空空如也', text: '請先加入一些補給品吧！', background: '#0d1b33', color: '#fff' });
                return;
            }

            // ⚠️ 您的官方帳號 ID
            const myLineID = "@479xavpe"; 

            // 1. 生成訂單文字
            let orderText = "【物資補給訂單】\n";
            let total = 0;
            
            // 統計商品數量 (優化顯示：同樣商品合併顯示)
            const itemCounts = {};
            cart.forEach(item => {
                if (!itemCounts[item.name]) itemCounts[item.name] = { count: 0, price: item.price };
                itemCounts[item.name].count++;
                total += item.price;
            });

            for (const [name, info] of Object.entries(itemCounts)) {
                orderText += `- ${name} x${info.count} (NT$${info.price * info.count})\n`;
            }

            orderText += `------------------\n總金額：NT$ ${total}\n------------------\n\n請協助填寫以下資料：\n1. 訂購人姓名：\n2. 聯絡電話：\n3. 寄送方式 (超商/宅配)：\n4. 收件地址/門市：`;

            const encodedText = encodeURIComponent(orderText);

            // 2. 判斷裝置並執行跳轉 (LINE OA URL Scheme)
            const lineUrl = `https://line.me/R/oaMessage/${myLineID}/?${encodedText}`;

            // 3. 執行
            window.location.href = lineUrl;
        }
    </script>
</body>
</html>