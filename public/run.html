<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŠ€æ²³æ¢ç´¢ - ç‰éœ²å¯¶åº«</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #050510;
            --neon-cyan: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff9d;
            --star-gold: #f2c94c;
        }
        body {
            margin: 0; padding: 0; background-color: var(--bg-dark); color: #fff;
            font-family: 'Microsoft JhengHei', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden; user-select: none; touch-action: none;
        }

        /* --- âœ¨ è¦–å·®æ˜Ÿç©ºèƒŒæ™¯ (å„ªåŒ–ç‰ˆ) --- */
        .stars-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%); z-index: -5; }
        /* ç§»é™¤ heavy SVG filterï¼Œæ”¹ç”¨ç´” CSS */
        .nebula { 
            position: fixed; top: 0; left: 0; width: 200%; height: 100%; 
            background: radial-gradient(circle at 50% 50%, rgba(0, 243, 255, 0.1), transparent 60%),
                        radial-gradient(circle at 20% 80%, rgba(255, 0, 255, 0.1), transparent 50%);
            animation: spaceMove 120s linear infinite; z-index: -4; 
        }
        .stars-1 { position: fixed; top: 0; left: 0; width: 200%; height: 100%; background: radial-gradient(1px 1px at 20px 30px, #fff, transparent); background-size: 100px 100px; animation: spaceMove 60s linear infinite; z-index: -4; opacity: 0.5; }
        .stars-2 { position: fixed; top: 0; left: 0; width: 200%; height: 100%; background: radial-gradient(1.5px 1.5px at 50px 80px, var(--neon-cyan), transparent); background-size: 150px 150px; animation: spaceMove 30s linear infinite; z-index: -3; opacity: 0.4; }
        
        @keyframes spaceMove { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        /* --- HUDå„€è¡¨æ¿ --- */
        .hud {
            position: absolute; top: 20px; width: 92%; max-width: 800px;
            display: flex; justify-content: space-between; align-items: center; z-index: 10;
        }
        .score-box { 
            font-family: 'Microsoft JhengHei', sans-serif; font-size: 1.2rem; font-weight: bold; 
            background: rgba(0, 0, 0, 0.6); padding: 8px 20px; border-radius: 30px;
            border: 1px solid rgba(0, 243, 255, 0.3); backdrop-filter: blur(4px);
        }
        .best-label { font-size: 0.95rem; color: var(--star-gold); margin-right: 15px; }
        .label-text { font-size: 0.8rem; opacity: 0.8; margin-right: 5px; font-weight: normal; }
        #score-val { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }
        .shield-icon { color: var(--neon-cyan); margin-left: 10px; display: none; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.5; transform: scale(0.9); } }

        canvas { display: block; background: transparent; cursor: pointer; }

        /* --- å½ˆçª—ä»‹é¢ --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 16, 0.7); 
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
            transition: 0.3s; opacity: 0; pointer-events: none;
        }
        .overlay.show { opacity: 1; pointer-events: auto; }

        .result-card {
            background: rgba(16, 24, 48, 0.9);
            border: 1px solid rgba(0, 243, 255, 0.5); padding: 40px; border-radius: 24px; text-align: center;
            width: 85%; max-width: 400px; 
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.1);
            transform: scale(0.95); transition: 0.3s; position: relative; overflow: hidden;
        }
        .overlay.show .result-card { transform: scale(1); }

        .rank-badge { display: inline-block; padding: 6px 25px; background: linear-gradient(45deg, var(--neon-pink), var(--neon-purple)); border-radius: 20px; font-weight: bold; margin-bottom: 15px; box-shadow: 0 0 15px var(--neon-pink); font-size: 1.1rem; border: 1px solid rgba(255,255,255,0.3); }
        .final-time { font-size: 3.5rem; font-weight: 900; margin: 10px 0; font-family: 'Courier New', monospace; color: #fff; text-shadow: 0 0 20px var(--neon-cyan); letter-spacing: -2px; }
        
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 25px; width: 100%; position: relative; z-index: 2; }
        .btn {
            background: linear-gradient(90deg, var(--neon-cyan), #00aaff); color: #000; border: none; padding: 14px 0; border-radius: 50px;
            font-size: 1.1rem; font-weight: 900; cursor: pointer; transition: 0.1s; text-decoration: none; text-align: center;
            box-shadow: 0 4px 15px rgba(0, 243, 255, 0.3); outline: none; user-select: none;
        }
        .btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .btn:active { transform: scale(0.98); }
        .btn-secondary { background: rgba(255,255,255,0.08); color: #fff; border: 1px solid rgba(255,255,255,0.2); box-shadow: none; }
        .btn-secondary:hover { background: rgba(255,255,255,0.15); border-color: #fff; }

        .hint { margin-top: 20px; font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>
    <div class="stars-bg"></div>
    <div class="nebula"></div>
    <div class="stars-1"></div>
    <div class="stars-2"></div>

    <div class="hud">
        <div class="score-box">
            <span class="best-label"><span class="label-text">æœ€é«˜:</span><span id="best-val">0.00ç§’</span></span>
            <span class="label-text">å­˜æ´»:</span><span id="score-val">0.00ç§’</span>
            <span id="shield-indicator" class="shield-icon"><i class="fa-solid fa-shield-halved"></i> è­·ç›¾</span>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="overlay" class="overlay show">
        <div class="result-card" id="start-card">
            <div style="font-size: 3rem; color: #fff; margin-bottom: 15px; text-shadow: 0 0 20px var(--neon-cyan);"><i class="fa-brands fa-space-awesome"></i></div>
            <h1 style="color:var(--neon-cyan); font-size: 2rem; margin-bottom: 5px; margin-top:0;">éŠ€æ²³æ¢ç´¢</h1>
            <p style="color:#aaa; letter-spacing:1px; font-size:0.9rem;">æ¥µé€Ÿç–¾è¡Œæ¨¡å¼ (HYPER RUNNER)</p>
            <div class="btn-group">
                <button class="btn" id="start-btn" onclick="initGame()">å•Ÿå‹•å¼•æ“</button>
                <a href="entertainment.html" class="btn btn-secondary">è¿”å›åŸºåœ°</a>
            </div>
            <div class="hint">æŒ‰ç©ºç™½éµ / é»æ“Šè¢å¹• è·³èº</div>
        </div>
        <div class="result-card" id="end-card" style="display:none;">
            <div id="rank-badge" class="rank-badge">è©•ç­‰ä¸­</div>
            <div style="color:#aaa; font-size: 0.9rem;">å­˜æ´»æ™‚é–“</div>
            <div class="final-time" id="final-time">0.00</div>
            <div class="btn-group">
                <button class="btn" id="restart-btn" onclick="initGame()">å†æ¬¡å‡ºæ“Š</button>
                <a href="entertainment.html" class="btn btn-secondary">è¿”å›åŸºåœ°</a>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreVal = document.getElementById('score-val');
        const bestVal = document.getElementById('best-val');
        const shieldIndicator = document.getElementById('shield-indicator');
        const overlay = document.getElementById('overlay');
        const startCard = document.getElementById('start-card');
        const endCard = document.getElementById('end-card');
        const rankBadge = document.getElementById('rank-badge');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        let gameWidth, gameHeight;
        let isPlaying = false;
        let isCrashed = false; 
        let startTime;
        let currentTime = 0;
        let bestTime = parseFloat(localStorage.getItem('galaxy_run_best') || 0);
        bestVal.innerText = bestTime.toFixed(2) + "ç§’";

        // --- ğŸ”¥ ç‰©ç†åƒæ•¸ (é›£åº¦èˆ‡é€Ÿåº¦å„ªåŒ–) ---
        const INITIAL_SPEED = 10;     // åˆå§‹é€Ÿåº¦æå‡
        const MAX_SPEED = 35;         // æœ€å¤§é€Ÿåº¦å¤§å¹…æå‡
        const ACCELERATION = 0.008;   // åŠ é€Ÿåº¦æå‡ (åŸæœ¬ 0.003)
        const GRAVITY = 1.5;          
        const JUMP_STRENGTH = -22;    
        
        let gameSpeed = INITIAL_SPEED;
        let gridOffset = 0;
        // ç§»é™¤æ˜‚è²´çš„é¡è‰²è¨ˆç®—ï¼Œé å…ˆå®šç¾©
        const STAR_COLORS = ['#00f3ff', '#ff00ff', '#f2c94c', '#00ff9d'];

        let player = {
            x: 100, y: 0, width: 50, height: 25, dy: 0, rotation: 0, hasShield: false,
            isOnGround: true,
            draw() {
                if(isCrashed) return;
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // è§’åº¦è¨ˆç®—
                let targetRot = this.isOnGround ? 0 : Math.min(Math.max(this.dy * 0.04, -0.4), 0.4);
                this.rotation += (targetRot - this.rotation) * 0.2;
                ctx.rotate(this.rotation);

                // è­·ç›¾ (å„ªåŒ–: æ¸›å°‘é™°å½±æ¨¡ç³Š)
                if(this.hasShield) {
                    ctx.beginPath(); ctx.arc(0, 5, 40, 0, Math.PI*2);
                    ctx.fillStyle = 'rgba(0, 243, 255, 0.15)'; ctx.fill();
                    ctx.strokeStyle = 'rgba(0, 243, 255, 0.6)'; ctx.lineWidth = 2; ctx.stroke();
                }

                // å°¾ç„° (å„ªåŒ–: æ¸›å°‘é™°å½±)
                ctx.fillStyle = '#00f3ff';
                let flameLen = this.isOnGround ? 20 : 45;
                ctx.beginPath(); ctx.moveTo(-15, 0); ctx.lineTo(-35 - Math.random()*flameLen, 5); ctx.lineTo(-15, 10); ctx.fill();

                // æ©Ÿèº«
                ctx.fillStyle = '#fff';
                ctx.beginPath(); 
                ctx.moveTo(30, 5); ctx.lineTo(-15, 15); ctx.lineTo(-5, 5); ctx.lineTo(-15, -5); 
                ctx.closePath(); ctx.fill();
                
                // åº§è‰™
                ctx.fillStyle = '#111'; ctx.beginPath(); ctx.moveTo(5, -2); ctx.lineTo(20, 2); ctx.lineTo(5, 5); ctx.fill();
                ctx.strokeStyle = '#00f3ff'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(-5, -2); ctx.lineTo(15, 5); ctx.stroke();
                
                // åªæœ‰ä¸»è§’ä¿ç•™å¾®å¼±å…‰æšˆ
                ctx.shadowBlur = 10; ctx.shadowColor = '#00f3ff';
                ctx.stroke(); ctx.shadowBlur = 0; // é‡ç½®ä»¥å…å½±éŸ¿å…¶ä»–ç¹ªåœ–

                ctx.restore();
            },
            jump() { 
                if(this.isOnGround) {
                    this.dy = JUMP_STRENGTH;
                    this.isOnGround = false;
                    createParticles(this.x, this.y + 10, '#00f3ff', 5, 3); 
                }
            }
        };

        let obstacles = [];
        let items = [];
        let particles = [];
        let frameCount = 0;

        function resize() {
            gameWidth = canvas.width = window.innerWidth;
            gameHeight = canvas.height = window.innerHeight;
            const horizonY = gameHeight * 0.85;
            if(!isPlaying && !isCrashed) player.y = horizonY - player.height/2;
        }

        function initGame() {
            obstacles = []; particles = []; items = [];
            gameSpeed = INITIAL_SPEED; 
            frameCount = 0; currentTime = 0;
            player.dy = 0; player.rotation = 0; player.hasShield = false; player.isOnGround = true;
            
            const horizonY = gameHeight * 0.85;
            player.y = horizonY - player.height/2;
            
            shieldIndicator.style.display = 'none';
            isCrashed = false; isPlaying = true; 
            startTime = Date.now();
            
            overlay.classList.remove('show');
            setTimeout(() => { startCard.style.display = 'none'; endCard.style.display = 'none'; }, 300);
        }

        // âš¡ æ•ˆèƒ½å„ªåŒ–ï¼šç§»é™¤ shadowBlurï¼Œæ”¹ç”¨ç°¡å–®å¡«å……
        function drawStar(cx, cy, spikes, outerRadius, innerRadius, color, rotOffset) {
            let rot = Math.PI/2*3 + rotOffset; let step = Math.PI/spikes;
            ctx.beginPath(); ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                ctx.lineTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius); rot += step;
                ctx.lineTo(cx + Math.cos(rot) * innerRadius, cy + Math.sin(rot) * innerRadius); rot += step;
            }
            ctx.closePath(); 
            ctx.fillStyle = color; 
            ctx.fill(); 
            // å…§æ ¸
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(cx, cy, innerRadius * 0.6, 0, Math.PI*2); ctx.fill();
        }

        function drawItem(item) {
            ctx.save();
            ctx.translate(item.x, item.y);
            let floatY = Math.sin(frameCount * 0.1) * 5;
            ctx.translate(0, floatY);
            
            // ç°¡åŒ–ç‰¹æ•ˆ
            ctx.fillStyle = 'rgba(0, 243, 255, 0.3)';
            ctx.beginPath(); ctx.arc(0, 0, item.size, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(0, 0, item.size*0.6, 0, Math.PI*2); ctx.stroke();
            ctx.fillStyle = '#fff'; ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('S', 0, 1);
            ctx.restore();
        }

        function drawGrid() {
            let horizonY = gameHeight * 0.85;
            
            // åœ°é¢å¡«å…… (æ¸›å°‘æ¼¸å±¤é‹ç®—ï¼Œä½¿ç”¨ç´”è‰²å¸¶é€æ˜åº¦)
            ctx.fillStyle = 'rgba(0, 243, 255, 0.08)'; 
            ctx.fillRect(0, horizonY, gameWidth, gameHeight - horizonY);

            // æ ¼ç·š
            ctx.strokeStyle = 'rgba(0, 243, 255, 0.2)'; ctx.lineWidth = 1;
            ctx.beginPath();
            gridOffset = (gridOffset - gameSpeed) % 120;
            for(let x = gridOffset; x < gameWidth; x += 120) { // æ¸›å°‘ç·šæ¢å¯†åº¦
                let topX = (x - gameWidth/2) * 0.1 + gameWidth/2; // èª¿æ•´é€è¦–
                ctx.moveTo(topX, horizonY); ctx.lineTo(x, gameHeight);
            }
            ctx.stroke();
            
            // åœ°å¹³ç·š
            ctx.strokeStyle = '#00f3ff'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0, horizonY); ctx.lineTo(gameWidth, horizonY); ctx.stroke();
            return horizonY;
        }

        function createParticles(x, y, color, count, speedMult) {
            // é™åˆ¶ç²’å­æ•¸é‡ä¸Šé™
            if(particles.length > 50) return; 
            for(let k=0; k<count; k++) {
                particles.push({
                    x: x, y: y, color: color,
                    size: Math.random() * 3 + 1,
                    vx: (Math.random() - 0.5) * 10 * speedMult,
                    vy: (Math.random() - 0.5) * 10 * speedMult,
                    life: 1.0, decay: 0.05 + Math.random() * 0.05
                });
            }
        }

        function update() {
            ctx.clearRect(0, 0, gameWidth, gameHeight);
            const groundY = drawGrid();
            const groundLimit = groundY - player.height/2;

            if(isPlaying) {
                currentTime = (Date.now() - startTime) / 1000;
                scoreVal.innerText = currentTime.toFixed(2) + "ç§’";
                
                // ğŸ”¥ åŠ é€Ÿèˆ‡é›£åº¦æ§åˆ¶
                if (gameSpeed < MAX_SPEED) gameSpeed += ACCELERATION;
                
                // å°¾ç„° (é™ä½ç”¢ç”Ÿé »ç‡)
                if(frameCount % 2 === 0) {
                    particles.push({
                        x: player.x - 10, y: player.y + 5 + (Math.random()-0.5)*5,
                        color: Math.random()>0.5 ? '#00f3ff':'#88ffff', size: Math.random() * 3,
                        vx: -gameSpeed * 0.8, vy: (Math.random()-0.5)*2, life: 0.5, decay: 0.1
                    });
                }

                if (!player.isOnGround) {
                    player.dy += GRAVITY;
                    player.y += player.dy;
                }

                if(player.y >= groundLimit) { 
                    player.y = groundLimit; player.dy = 0; player.isOnGround = true;
                } else {
                    player.isOnGround = false;
                }
                
                player.draw();

                // ğŸ”¥ éšœç¤™ç‰©ç”Ÿæˆé‚è¼¯ (é«˜å¯†åº¦)
                // åŸºç¤ç”Ÿæˆç‡éš¨æ™‚é–“è®Šå¿«ï¼Œå¾ 50 å¹€/å€‹ é™åˆ° 15 å¹€/å€‹
                let baseRate = Math.max(15, 50 - Math.floor(currentTime * 2));
                if(frameCount % baseRate === 0) {
                    let lastObs = obstacles[obstacles.length - 1];
                    // å‹•æ…‹è¨ˆç®—å®‰å…¨é–“è·ï¼šé€Ÿåº¦è¶Šå¿«ï¼Œé–“è·éœ€è¦è¶Šå¤§
                    let safeGap = 200 + (gameSpeed * 8); 
                    
                    if (!lastObs || (gameWidth - lastObs.x > safeGap)) {
                        let size = Math.random() * 20 + 25;
                        obstacles.push({
                            x: gameWidth + size,
                            y: groundLimit - size + 10,
                            size: size,
                            color: STAR_COLORS[Math.floor(Math.random() * STAR_COLORS.length)],
                            rotation: 0, rotSpeed: (Math.random() + 0.5) * 0.1
                        });
                    }
                }

                if(frameCount % 600 === 0 && !player.hasShield) {
                    items.push({ x: gameWidth + 50, y: groundLimit - 120, size: 20, type: 'shield' });
                }

                frameCount++;
            } else if(isCrashed) {
                gameSpeed *= 0.9; // ç¢°æ’å¾Œå¿«é€Ÿæ¸›é€Ÿ
                if(gameSpeed < 0.5) gameSpeed = 0;
            }

            // æ›´æ–°éšœç¤™ç‰©
            for(let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                obs.x -= gameSpeed; obs.rotation += obs.rotSpeed;
                
                // å„ªåŒ–ï¼šç•«é¢å¤–ä¸ç¹ªè£½
                if(obs.x > -50 && obs.x < gameWidth + 50) {
                    ctx.save(); ctx.translate(obs.x, obs.y);
                    drawStar(0, 0, 5, obs.size, obs.size*0.4, obs.color, obs.rotation);
                    ctx.restore();
                }

                if(isPlaying) {
                    // ğŸ”¥ åˆ¤å®šå¯¬å®¹åº¦ï¼šç¢°æ’ç®±ç¸®å°è‡³ 70%
                    let hitDist = (obs.size + player.width/2) * 0.7; 
                    let dx = player.x - obs.x; let dy = player.y - obs.y;
                    
                    if (Math.sqrt(dx*dx + dy*dy) < hitDist) {
                        if(player.hasShield) {
                            player.hasShield = false;
                            shieldIndicator.style.display = 'none';
                            createParticles(player.x, player.y, '#00f3ff', 15, 2);
                            obstacles.splice(i, 1); 
                        } else {
                            handleCrash(obs);
                        }
                    }
                }
                if(obs.x + obs.size < -100) obstacles.splice(i, 1);
            }

            // æ›´æ–°é“å…·
            for(let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.x -= gameSpeed;
                drawItem(item);
                if(isPlaying) {
                    let dx = player.x - item.x; let dy = player.y - item.y;
                    if(Math.sqrt(dx*dx + dy*dy) < item.size + player.width/2) {
                        if(item.type === 'shield') {
                            player.hasShield = true;
                            shieldIndicator.style.display = 'inline-block';
                            createParticles(player.x, player.y, '#fff', 10, 1);
                        }
                        items.splice(i, 1);
                    }
                }
                if(item.x < -50) items.splice(i, 1);
            }

            // æ›´æ–°ç²’å­ (ç°¡å–®ç‰©ç†)
            ctx.globalAlpha = 0.8;
            for(let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= p.decay;
                if(p.life <= 0) { particles.splice(i, 1); continue; }
                ctx.fillStyle = p.color; 
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
            }
            ctx.globalAlpha = 1.0;

            requestAnimationFrame(update);
        }

        function handleCrash(obs) {
            isPlaying = false; isCrashed = true;
            createParticles(player.x, player.y, '#fff', 20, 1.5); 
            createParticles(obs.x, obs.y, obs.color, 15, 1); 
            gameOver();
        }

        function getRank(s) {
            if(s < 15) return { t: "æ˜Ÿéš›å¡µåŸƒ", c: "linear-gradient(45deg, #777, #aaa)" };
            if(s < 30) return { t: "è¶…å…‰é€Ÿæ–°å…µ", c: "linear-gradient(45deg, #00f3ff, #0077ff)" };
            if(s < 60) return { t: "æ™‚ç©ºè­·èˆªè€…", c: "linear-gradient(45deg, #00ff9d, #00cc55)" };
            if(s < 100) return { t: "çµæˆ¶åº§ç‹ç‰Œ", c: "linear-gradient(45deg, #f2c94c, #f2994a)" };
            return { t: "éŠ€æ²³å‚³å¥‡", c: "linear-gradient(45deg, #ff00ff, #bc13fe)" };
        }

        function gameOver() {
            if(currentTime > bestTime) {
                bestTime = currentTime; localStorage.setItem('galaxy_run_best', bestTime);
                bestVal.innerText = bestTime.toFixed(2) + "ç§’";
            }
            document.getElementById('final-time').innerText = currentTime.toFixed(2) + "ç§’";
            const r = getRank(currentTime);
            rankBadge.innerText = r.t; rankBadge.style.background = r.c; 
            setTimeout(() => { overlay.classList.add('show'); endCard.style.display = 'block'; }, 500);
        }

        // --- ğŸ® äº‹ä»¶è™•ç† (Bug Fix: æ’é™¤æŒ‰éˆ•é»æ“Š) ---
        function jumpAction(e) {
            // ğŸ”¥ ä¿®æ­£ï¼šé»æ“ŠæŒ‰éˆ•ä¸è§¸ç™¼è·³èº
            if (e && e.target && (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || e.target.closest('button') || e.target.closest('a'))) {
                return; 
            }

            if (e && e.preventDefault && e.type !== 'mousedown') {
                e.preventDefault();
            }

            if(isPlaying) {
                player.jump();
            } else if (overlay.classList.contains('show')) {
                // åªæœ‰åœ¨éæŒ‰éˆ•å€åŸŸé»æ“Šæ™‚ï¼Œä¸” endCard é¡¯ç¤ºæ™‚ï¼Œæ‰å…è¨±å¿«é€Ÿé‡é–‹
                // (é¿å…èª¤è§¸)
            }
        }

        window.addEventListener('keydown', (e) => { 
            if(e.code === 'Space' || e.key === ' ' || e.keyCode === 32 || e.code === 'ArrowUp') {
                if(isPlaying) {
                    e.preventDefault(); // é˜²æ­¢ç©ºç™½éµæ»¾å‹•
                    player.jump();
                } else if(endCard.style.display === 'block') {
                    initGame(); // éµç›¤å¯ä»¥ç›´æ¥é‡é–‹
                }
            }
        });
        
        window.addEventListener('touchstart', (e) => { jumpAction(e); }, {passive: false});
        window.addEventListener('mousedown', (e) => { if(e.button === 0) jumpAction(e); });
        
        window.addEventListener('resize', resize);
        resize();
        requestAnimationFrame(update);
    </script>
</body>
</html>