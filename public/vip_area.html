<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿå“¡å€ - ç‰éœ²å¯¶åº«</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            /* ğŸ¨ æ˜Ÿéš›å¥¢è¯é…è‰² */
            --main-gold: #FFD700;       
            --accent-amber: #FDB931;    
            --deep-space: #0f172a;      
            --nebula-blue: #00f3ff;     
            --danger-red: #ff4757;      
            
            /* ç»ç’ƒæ“¬æ…‹ */
            --glass-bg: rgba(15, 23, 42, 0.65); 
            --glass-border: rgba(255, 255, 255, 0.1);
            --card-hover-bg: rgba(30, 41, 59, 0.8);
        }

        body {
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            color: #e2e8f0;
            font-family: 'Microsoft JhengHei', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; opacity: 0; transition: opacity 0.5s;
            padding-bottom: 80px;
            position: relative;
            overflow-x: hidden;
        }

        /* --- èƒŒæ™¯æ˜Ÿç©ºå‹•ç•« --- */
        .space-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .star-field { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background-repeat: repeat; opacity: 0.5; animation-timing-function: linear; animation-iteration-count: infinite; }
        .stars-distant {
            background-image: 
                radial-gradient(1px 1px at 10% 15%, #fff, transparent),
                radial-gradient(1px 1px at 30% 60%, #ddd, transparent),
                radial-gradient(1px 1px at 70% 20%, #eee, transparent);
            background-size: 300px 300px;
            animation-name: rotateSpace; animation-duration: 240s;
        }
        .stars-mid {
            background-image: 
                radial-gradient(1.5px 1.5px at 25% 10%, #fff, transparent),
                radial-gradient(1.5px 1.5px at 60% 35%, #eef, transparent);
            background-size: 400px 400px; opacity: 0.6;
            animation-name: rotateSpace; animation-duration: 180s; animation-direction: reverse;
        }
        .gold-twinklers {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image:
                radial-gradient(2px 2px at 20% 30%, var(--main-gold), transparent),
                radial-gradient(3px 3px at 65% 25%, #fff59d, transparent);
            background-size: 100% 100%; opacity: 0;
            animation: occasionalFlash 12s ease-in-out infinite;
        }
        @keyframes rotateSpace { from { transform: rotate(0deg) translateZ(0); } to { transform: rotate(360deg) translateZ(0); } }
        @keyframes occasionalFlash { 0%, 40%, 100% { opacity: 0; } 55% { opacity: 1; filter: brightness(2) blur(1px); } 85% { opacity: 0; } }

        /* --- é ‚éƒ¨å€åŸŸ --- */
        .logout-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255,255,255,0.2);
            color: #94a3b8; padding: 8px 15px; border-radius: 20px; cursor: pointer;
            transition: 0.3s; z-index: 20; display: flex; align-items: center; gap: 8px;
            backdrop-filter: blur(5px); font-size: 0.9rem;
        }
        .logout-btn:hover { background: var(--danger-red); border-color: var(--danger-red); color: #fff; box-shadow: 0 0 15px rgba(255, 71, 87, 0.4); }

        .header { text-align: center; margin-top: 60px; margin-bottom: 40px; position: relative; z-index: 2; }
        
        h1 { 
            font-size: 3.5rem; margin: 0 0 15px 0; letter-spacing: 5px; font-weight: 900;
            background: linear-gradient(to bottom, #fff 0%, var(--main-gold) 100%);
            -webkit-background-clip: text; color: transparent;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.4));
        }
        
        .user-greeting { 
            color: #94a3b8; font-size: 1.1rem; letter-spacing: 2px; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            text-transform: uppercase;
        }
        .user-avatar { 
            width: 40px; height: 40px; border-radius: 50%; object-fit: cover; 
            border: 2px solid var(--main-gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            background: #000;
        }
        .user-id { color: var(--main-gold); font-weight: bold; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

        .stars-badge {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(253, 185, 49, 0.1));
            border: 1px solid var(--accent-amber);
            color: var(--main-gold); padding: 8px 20px; border-radius: 30px;
            margin-top: 20px; display: inline-flex; align-items: center; gap: 10px;
            font-weight: bold; font-size: 1.2rem; box-shadow: 0 0 20px rgba(255, 215, 0, 0.15);
            cursor: pointer; transition: 0.3s; text-decoration: none;
        }
        .stars-badge:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(255, 215, 0, 0.3); background: rgba(255, 215, 0, 0.2); }
        .stars-badge i { animation: rotateStar 4s infinite linear; }
        @keyframes rotateStar { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

        /* --- ç¶²æ ¼ä½ˆå±€ --- */
        .secret-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px; width: 90%; max-width: 1100px;
            position: relative; z-index: 2;
        }

        /* --- å¡ç‰‡æ¨£å¼ --- */
        .secret-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 30px; border-radius: 20px;
            text-decoration: none; color: #fff;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .secret-card:hover { 
            transform: translateY(-8px); 
            background: var(--card-hover-bg); 
            border-color: var(--main-gold);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(255, 215, 0, 0.05); 
        }
        
        .secret-card i { 
            font-size: 3rem; margin-bottom: 20px; transition: 0.4s; 
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            color: #cbd5e1; 
        }
        .secret-card:hover i { transform: scale(1.1) rotate(5deg); color: var(--main-gold) !important; filter: drop-shadow(0 0 15px var(--main-gold)); }
        
        .secret-card h3 { 
            margin: 0 0 10px 0; font-size: 1.4rem; letter-spacing: 1px; color: #fff;
            transition: 0.3s; 
        }
        .secret-card:hover h3 { color: var(--main-gold); }

        .secret-card p { color: #94a3b8; font-size: 0.95rem; margin: 0; line-height: 1.6; }
        
        .tag { 
            position: absolute; top: 15px; right: 15px; 
            font-size: 0.7rem; padding: 4px 10px; border-radius: 20px; 
            font-weight: bold; color: #000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* ç‰¹å®šå¡ç‰‡é¡è‰²å¾®èª¿ */
        .card-vegas { border-bottom: 3px solid var(--main-gold); }
        .card-vegas i { color: var(--main-gold); }
        .card-admin { border-bottom: 3px solid var(--danger-red); }
        .card-shop { border-bottom: 3px solid var(--accent-amber); }
        .card-files { border-bottom: 3px solid var(--nebula-blue); }

        .admin-divider {
            grid-column: 1 / -1; margin-top: 40px; margin-bottom: 20px;
            display: flex; align-items: center; gap: 20px; 
            color: var(--danger-red); font-weight: bold; letter-spacing: 3px; font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
        }
        .admin-divider::before, .admin-divider::after { 
            content: ''; flex: 1; height: 1px; 
            background: linear-gradient(90deg, transparent, var(--danger-red), transparent); 
            opacity: 0.5;
        }

    </style>
</head>
<body>

    <div class="space-container">
        <div class="star-field stars-distant"></div>
        <div class="star-field stars-mid"></div>
        <div class="gold-twinklers"></div>
    </div>

    <button class="logout-btn" onclick="handleLogout()">
        <i class="fa-solid fa-right-from-bracket"></i> ç™»å‡ºç³»çµ±
    </button>

    <div class="header">
        <h1>æ˜Ÿå“¡å€</h1>
        <div class="user-greeting">
            <img src="" id="header-avatar" class="user-avatar" style="display:none">
            <span>COMMANDER</span>
            <span id="current-user" class="user-id">---</span>
        </div>
        <a href="point_history.html" class="stars-badge">
            <i class="fa-solid fa-star"></i>
            <span id="star-count">...</span> 
        </a>
    </div>

    <div class="secret-grid">
        
        <a href="profile.html" class="secret-card">
            <i class="fa-solid fa-user-pen"></i>
            <h3>å€‹äººè¨­å®š</h3>
            <p>æ›´æ”¹ç”¨æˆ¶åç¨±åŠé ­åƒ</p>
        </a>

        <a href="shop.html" class="secret-card card-shop">
            <i class="fa-solid fa-gift" style="color: var(--accent-amber);"></i>
            <h3>æ˜Ÿæ˜Ÿå…Œæ›</h3>
            <p>åˆ©ç”¨æ˜Ÿæ˜Ÿå…Œæ›çå“</p>
        </a>

        <a href="point_history.html" class="secret-card">
            <i class="fa-solid fa-file-invoice-dollar" style="color: #4ade80;"></i>
            <h3>æ˜Ÿå­˜æ‘º</h3>
            <p>æŸ¥çœ‹é»æ•¸é…ç™¼èˆ‡æ¶ˆè€—ç´€éŒ„ã€‚</p>
        </a>

        <a href="casino.html" class="secret-card card-vegas">
            <i class="fa-solid fa-dice" style="text-shadow: 0 0 15px var(--main-gold);"></i>
            <h3>æ˜Ÿç¶­åŠ æ–¯</h3>
            <p>ä»¥å°åšå¤§ï¼Œè·é›¢ç™¼è²¡åªæœ‰ä¸€æ­¥</p>
        </a>

        <a href="temp_share.html" class="secret-card card-files">
            <i class="fa-solid fa-cloud-arrow-up" style="color: var(--nebula-blue);"></i>
            <h3>è³‡æ–™å‚³è¼¸</h3>
            <p>é™æ™‚åŠ å¯†è³‡æ–™å‚³è¼¸åŠŸèƒ½</p>
        </a>

        <a href="whiteboard_lobby.html" class="secret-card">
            <span class="tag" style="background: var(--nebula-blue);">LIVE</span>
            <i class="fa-solid fa-paintbrush"></i>
            <h3>æ˜Ÿç©ºç¹ªåœ–æ¿</h3>
            <p>å¤šäººå¯¦æ™‚æœƒç•«åŠŸèƒ½</p>
        </a>

        <a href="upload_zone.html" class="secret-card">
            <i class="fa-solid fa-image"></i>
            <h3>åœ–ç‰‡å‚³è¼¸å™¨</h3>
            <p>å£“ç¸®åœ–ç‰‡ï¼Œæä¾›æš«å­˜èˆ‡åœ–åº«åŠŸèƒ½</p>
        </a>

        <a href="chat.html" class="secret-card">
            <i class="fa-solid fa-satellite-dish" style="color: #60a5fa;"></i>
            <h3>æ˜Ÿå“¡é€šè¨Šå®¤</h3>
            <p>åŠ å¯†é€£ç·šèˆ‡ç¾¤çµ„é€šè¨Š</p>
        </a>

        <a href="leaderboard.html" class="secret-card">
            <i class="fa-solid fa-trophy" style="color: #fcd34d;"></i>
            <h3>éŠ€æ²³åäººå ‚</h3>
            <p>æŸ¥çœ‹æœ€å¼·æŒ‡æ®å®˜æ’å</p>
        </a>
        
        <div class="admin-divider"><i class="fa-solid fa-user-shield"></i> ç®¡ç†å“¡å¾Œå°</div>

        <a href="admin_members.html" class="secret-card card-admin">
            <span class="tag" style="background: var(--main-gold);">ADMIN</span>
            <i class="fa-solid fa-users-gear"></i>
            <h3>æ˜Ÿå“¡æª”æ¡ˆåº«</h3>
            <p>æŸ¥çœ‹æœƒå“¡åˆ—è¡¨èˆ‡èª¿æ•´é»æ•¸ã€‚</p>
        </a>

        <a href="admin_shop.html" class="secret-card card-admin">
            <span class="tag" style="background: var(--main-gold);">ADMIN</span>
            <i class="fa-solid fa-warehouse"></i>
            <h3>æ˜Ÿæ˜Ÿå…Œæ›å€‰åº«</h3>
            <p>ä¸Šæ¶çå“èˆ‡æŸ¥çœ‹å…Œæ›ç´€éŒ„ã€‚</p>
        </a>

        <a href="admin_invite.html" class="secret-card card-admin">
            <span class="tag" style="background: var(--nebula-blue);">ADMIN</span>
            <i class="fa-solid fa-ticket"></i>
            <h3>é‚€è«‹ä¸­å¿ƒ</h3>
            <p>ç”Ÿæˆèˆ‡ç®¡ç†å…¥éšŠé‚€è«‹ç¢¼ã€‚</p>
        </a>

        <a href="admin_transfers.html" class="secret-card card-admin">
            <span class="tag" style="background: var(--danger-red);">ADMIN</span>
            <i class="fa-solid fa-network-wired"></i>
            <h3>æ–‡ä»¶å‚³è¼¸ç®¡ç†å“¡</h3>
            <p>å¼·åˆ¶ç®¡ç†èˆ‡éŠ·æ¯€æ‰€æœ‰å‚³è¼¸æª”æ¡ˆã€‚</p>
        </a>

        <a href="index.html" class="secret-card" style="border-color: rgba(255,255,255,0.1);">
            <i class="fa-solid fa-house" style="color: #64748b;"></i>
            <h3>è¿”å›è¡¨å±¤</h3>
            <p>å›åˆ°ä¸€èˆ¬ä½¿ç”¨è€…çš„é¦–é ã€‚</p>
        </a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAAo6on0f2QUbPaRfxpIEb2uvhKxDvPUvs",
            authDomain: "yulubox.firebaseapp.com",
            projectId: "yulubox",
            storageBucket: "yulubox.firebasestorage.app",
            messagingSenderId: "256466567852",
            appId: "1:256466567852:web:233b74668908ffcb9b9509",
            measurementId: "G-YPCY41EKWX"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ğŸ”¥ å…¨åŸŸé è¨­é ­åƒ (æ˜Ÿæ˜Ÿ)
        const DEFAULT_STAR_AVATAR = "https://cdn-icons-png.flaticon.com/512/1828/1828884.png";

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.body.style.opacity = "1";
                const name = user.displayName || user.email.split('@')[0];
                document.getElementById('current-user').innerText = name;

                const avatar = document.getElementById('header-avatar');
                // ä½¿ç”¨è€…è‹¥ç„¡é ­åƒï¼Œæˆ–é ­åƒé€£çµå¤±æ•ˆï¼Œé è¨­ä½¿ç”¨æ˜Ÿæ˜Ÿ
                avatar.src = user.photoURL || DEFAULT_STAR_AVATAR;
                avatar.style.display = 'block';

                try {
                    const docSnap = await getDoc(doc(db, "users", user.uid));
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        
                        const stars = data.stars !== undefined ? data.stars : 0;
                        document.getElementById('star-count').innerText = stars;

                        if (data.themeColor) {
                            const userIdEl = document.querySelector('.user-id');
                            const userAvatarEl = document.querySelector('.user-avatar');
                            userIdEl.style.color = data.themeColor;
                            userIdEl.style.textShadow = `0 0 10px ${data.themeColor}`;
                            userAvatarEl.style.borderColor = data.themeColor;
                            userAvatarEl.style.boxShadow = `0 0 10px ${data.themeColor}`;
                        }
                    }
                } catch(e) { console.log("Profile load error", e); }
            } else {
                window.location.href = "login.html";
            }
        });

        window.handleLogout = function() {
            signOut(auth).then(() => {
                window.location.href = 'index.html';
            }).catch((error) => { console.error(error); });
        }
    </script>
</body>
</html>