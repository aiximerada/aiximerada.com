<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜Ÿç¶­åŠ æ–¯ - ç‰éœ²å¯¶åº«</title>
    <script src="theme.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --main-gold: #FFD700;       
            --accent-amber: #FDB931;    
            --danger-red: #ff4757;      
            --nebula-purple: #d946ef; 
            --glass-bg: rgba(15, 23, 42, 0.85); 
            --card-radius: 16px;
        }
        
        body {
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            color: #e2e8f0;
            font-family: 'Microsoft JhengHei', sans-serif;
            min-height: 100vh; margin: 0; display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden; touch-action: manipulation; padding-bottom: 160px;
            position: relative;
        }

        /* --- æ˜Ÿç©ºèƒŒæ™¯ --- */
        .space-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .star-field { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background-repeat: repeat; opacity: 0.5; animation-timing-function: linear; animation-iteration-count: infinite; }
        .stars-distant {
            background-image: radial-gradient(1px 1px at 10% 15%, #fff, transparent), radial-gradient(1px 1px at 30% 60%, #ddd, transparent), radial-gradient(1px 1px at 70% 20%, #eee, transparent);
            background-size: 300px 300px; animation-name: rotateSpace; animation-duration: 240s;
        }
        .stars-mid {
            background-image: radial-gradient(1.5px 1.5px at 25% 10%, #fff, transparent), radial-gradient(1.5px 1.5px at 60% 35%, #eef, transparent);
            background-size: 400px 400px; opacity: 0.6; animation-name: rotateSpace; animation-duration: 180s; animation-direction: reverse;
        }
        .gold-twinklers {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(2px 2px at 20% 30%, var(--main-gold), transparent), radial-gradient(3px 3px at 65% 25%, #fff59d, transparent);
            background-size: 100% 100%; opacity: 0; animation: occasionalFlash 12s ease-in-out infinite;
        }
        @keyframes rotateSpace { from { transform: rotate(0deg) translateZ(0); } to { transform: rotate(360deg) translateZ(0); } }
        @keyframes occasionalFlash { 0%, 40%, 100% { opacity: 0; } 55% { opacity: 1; filter: brightness(2) blur(1px); } 85% { opacity: 0; } }

        #fxCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }

        /* --- ç¶­è­·é®ç½© --- */
        .maintenance-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.98); z-index: 10000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            backdrop-filter: blur(25px); text-align: center;
        }
        .maintenance-overlay.active { display: flex; animation: fadeIn 0.5s; }
        .m-icon { font-size: 6rem; color: var(--danger-red); margin-bottom: 25px; animation: pulse 1.5s infinite; filter: drop-shadow(0 0 20px rgba(255, 71, 87, 0.5)); }
        .m-title { font-size: 2.5rem; color: #fff; font-weight: 900; margin-bottom: 10px; letter-spacing: 5px; }
        .m-desc { color: #94a3b8; margin-bottom: 40px; font-size: 1.2rem; letter-spacing: 2px; }
        .btn-home { 
            padding: 16px 50px; border-radius: 50px; background: linear-gradient(135deg, var(--main-gold), var(--accent-amber)); 
            color: #000; text-decoration: none; font-weight: 900; font-size: 1.2rem;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3); transition: 0.3s;
        }
        @keyframes pulse { 0%{opacity:0.6; transform:scale(0.95);} 50%{opacity:1; transform:scale(1.05);} 100%{opacity:0.6; transform:scale(0.95);} }

        /* --- é ‚éƒ¨å°èˆª --- */
        .header {
            width: 100%; padding: 15px 20px; background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box; position: sticky; top: 0; z-index: 100;
        }
        .back-btn { color: #94a3b8; text-decoration: none; font-size: 1rem; display: flex; align-items: center; gap: 5px; }
        .balance-badge {
            background: rgba(255, 215, 0, 0.1); border: 1px solid var(--accent-amber);
            color: var(--main-gold); padding: 6px 15px; border-radius: 20px; font-weight: bold;
            display: flex; align-items: center; gap: 8px; font-size: 1rem;
        }
        .balance-update { animation: popGold 0.5s ease; }
        @keyframes popGold { 50%{transform:scale(1.2); color:#000; background:var(--main-gold);} }

        .vegas-title { text-align: center; margin: 30px 0 20px 0; }
        .vegas-title h1 {
            margin: 0; font-size: 3rem; letter-spacing: 5px; font-weight: 900;
            background: linear-gradient(to bottom, #fff 0%, var(--main-gold) 100%);
            -webkit-background-clip: text; color: transparent;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }
        .vegas-title p { color: #64748b; margin-top: 5px; font-size: 0.95rem; letter-spacing: 3px; text-transform: uppercase; }

        /* --- éŠæˆ²èˆå° --- */
        .stage {
            width: 95%; max-width: 800px;
            background: var(--glass-bg); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px; padding: 30px 20px; text-align: center;
            position: relative; min-height: 460px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            backdrop-filter: blur(16px);
            display: flex; flex-direction: column; transition: 0.3s;
        }
        .stage.winner-glow { border-color: var(--main-gold); box-shadow: 0 0 60px rgba(255, 215, 0, 0.2); }
        .stage.loser-shake { animation: shake 0.4s ease-in-out; border-color: var(--danger-red); }
        @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-5px);} 75%{transform:translateX(5px);} }

        /* --- ğŸ¡ æ˜Ÿä¹‹è¼ªç›¤æ¨£å¼ --- */
        .wheel-container { position: relative; width: 300px; height: 300px; margin: 20px auto; }
        #wheelCanvas { width: 100%; height: 100%; transform-origin: 50% 50%; transition: transform 4s cubic-bezier(0.1, 0.99, 0.1, 0.99); }
        .wheel-pointer { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); width: 0; height: 0; z-index: 10; border-left: 18px solid transparent; border-right: 18px solid transparent; border-top: 35px solid var(--main-gold); filter: drop-shadow(0 4px 4px rgba(0,0,0,0.6)); }
        
        .wheel-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background: radial-gradient(circle, #fff, var(--main-gold));
            border-radius: 50%; box-shadow: 0 0 20px var(--main-gold);
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; color: #000; font-size: 1.2rem; cursor: pointer; z-index: 5;
            border: 4px solid #fff;
            transition: all 0.3s ease;
        }
        .wheel-center:active { transform: translate(-50%, -50%) scale(0.95); }
        .wheel-center:disabled { filter: grayscale(1); opacity: 0.8; cursor: not-allowed; }

        .cooldown-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); border-radius: 50%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            z-index: 20; backdrop-filter: blur(5px); color: var(--main-gold);
        }
        .timer-text { font-size: 1.5rem; font-family: monospace; font-weight: bold; margin-top: 10px; }

        /* --- ğŸƒ å¡ç‰Œå€åŸŸ --- */
        .card-area { 
            display: flex; justify-content: center; gap: 15px; 
            margin: 15px 0; perspective: 1000px; flex-wrap: wrap; min-height: 150px; align-items: center;
        }
        .poker-card {
            width: 100px; height: 145px; border-radius: var(--card-radius); 
            position: relative; font-family: 'Courier New', Courier, monospace; font-weight: bold; 
            background-color: transparent; box-shadow: none; opacity: 1; transform: none; 
        }
        .poker-card.card-red, .poker-card.card-black { background-color: #fff; box-shadow: 0 10px 25px rgba(0,0,0,0.5); border: 1px solid #ccc; }
        .card-corner { position: absolute; display: flex; flex-direction: column; align-items: center; line-height: 1; font-size: 1.3rem; }
        .top-left { top: 6px; left: 6px; }
        .bottom-right { bottom: 6px; right: 6px; transform: rotate(180deg); }
        .card-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3.5rem; }
        .card-red .card-corner, .card-red .card-center { color: #c0392b !important; }
        .card-black .card-corner, .card-black .card-center { color: #2c3e50 !important; }
        .card-back {
            background-color: #1e293b;
            background-image: radial-gradient(circle, #334155 2px, transparent 2.5px);
            background-size: 16px 16px;
            border: 3px solid #fff; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .card-back::after { content: 'âœ¦'; color: var(--main-gold); font-size: 3.5rem; text-shadow: 0 0 15px var(--main-gold); }
        .deal-anim { animation: dealSlide 0.4s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        @keyframes dealSlide { 0% { opacity: 0; transform: translateY(-40px); } 100% { opacity: 1; transform: translateY(0); } }

        /* --- ğŸ² éª°å­å€åŸŸ --- */
        .dice-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 200px; position: relative; }
        .dice-glow { position: absolute; width: 150px; height: 150px; border-radius: 50%; background: radial-gradient(circle, rgba(217, 70, 239, 0.3), transparent 70%); animation: pulseGlow 2s infinite ease-in-out; pointer-events: none; }
        .dice-display { font-size: 8rem; color: #fff; text-shadow: 0 0 40px rgba(217, 70, 239, 0.8); z-index: 2; transition: 0.2s; }
        .dice-rolling { animation: rollShake 0.3s infinite linear; color: var(--nebula-purple); }
        @keyframes rollShake { 0% { transform: rotate(0deg) scale(1); } 25% { transform: rotate(15deg) scale(1.1); } 50% { transform: rotate(-15deg) scale(0.9); } 75% { transform: rotate(5deg) scale(1.05); } 100% { transform: rotate(0deg) scale(1); } }
        .dice-control-panel { background: rgba(217, 70, 239, 0.05); border: 1px solid rgba(217, 70, 239, 0.2); border-radius: 16px; padding: 15px; margin-top: 25px; display: flex; flex-direction: column; gap: 10px; }
        .dice-header { color: var(--nebula-purple); font-weight: bold; font-size: 1rem; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; gap: 8px; text-shadow: 0 0 10px rgba(217, 70, 239, 0.3); }
        .dice-selector { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; z-index: 2; position: relative; }
        .dice-btn { width: 50px; height: 50px; border-radius: 12px; border: 2px solid var(--nebula-purple); background: rgba(0,0,0,0.3); color: var(--nebula-purple); font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px rgba(217, 70, 239, 0.1); }
        .dice-btn:hover { background: rgba(217, 70, 239, 0.2); transform: translateY(-3px); }
        .dice-btn.selected { background: var(--nebula-purple); color: #fff; border-color: #fff; box-shadow: 0 0 25px var(--nebula-purple); transform: scale(1.1); }

        /* æŒ‰éˆ•èˆ‡é¢æ¿ */
        .game-tabs { display: flex; gap: 10px; margin-bottom: 25px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 50px; flex-wrap: wrap; justify-content: center; }
        .tab-btn { background: transparent; border: none; color: #64748b; padding: 10px 20px; border-radius: 40px; cursor: pointer; font-weight: bold; transition: 0.3s; white-space: nowrap; }
        .tab-btn.active { background: linear-gradient(135deg, var(--main-gold), var(--accent-amber)); color: #0f172a; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }

        .bet-panel { margin-bottom: 25px; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
        .bet-input-group { display: flex; gap: 10px; justify-content: center; margin-top: 15px; }
        .bet-input { background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; color: var(--main-gold); padding: 12px; border-radius: 12px; width: 140px; text-align: center; font-size: 1.5rem; font-weight: bold; }
        .btn-all-in { background: linear-gradient(135deg, #ef4444, #b91c1c); color: #fff; border: none; padding: 0 25px; border-radius: 12px; font-weight: bold; cursor: pointer; }

        .btn-action {
            background: linear-gradient(135deg, var(--main-gold), var(--accent-amber)); 
            color: #0f172a; border: none; padding: 16px 50px;
            border-radius: 50px; font-size: 1.3rem; cursor: pointer; margin-top: 25px;
            font-weight: 900; box-shadow: 0 10px 30px rgba(255, 215, 0, 0.25); width: 85%; max-width: 350px;
        }
        /* ğŸ”¥ æŒ‰éˆ•ç¦ç”¨æ¨£å¼ (é˜²å‘†è¦–è¦ºå›é¥‹) */
        .btn-action:disabled, .btn-bj:disabled, .btn-choice:disabled, .btn-collect:disabled, .btn-double:disabled, #btnAllIn:disabled { 
            background: #334155 !important; color: #64748b !important; cursor: not-allowed; box-shadow: none !important; opacity: 0.7;
        }

        .result-msg { font-size: 1.6rem; margin-top: 25px; font-weight: bold; min-height: 40px; text-shadow: 0 2px 10px rgba(0,0,0,0.8); opacity: 0; transition: 0.5s; }
        .result-msg.show { opacity: 1; transform: scale(1.1); }
        .win { color: var(--main-gold); } .lose { color: var(--danger-red); }

        .bj-controls { display: none; gap: 20px; justify-content: center; margin-top: 30px; }
        .btn-bj { padding: 15px 35px; border-radius: 30px; font-size: 1.1rem; border: none; cursor: pointer; font-weight: bold; color: #fff; display: flex; align-items: center; gap: 8px; }
        .btn-hit { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .btn-stand { background: linear-gradient(135deg, #ef4444, #dc2626); }

        .score-box { background: rgba(0,0,0,0.6); padding: 4px 10px; border-radius: 6px; font-family: monospace; border: 1px solid rgba(255,255,255,0.2); }

        .bottom-float-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; z-index: 500; display: flex; flex-direction: column; gap: 15px; pointer-events: none; }
        .bottom-float-bar > * { pointer-events: auto; }

        #btnReset { width: 100%; background: rgba(30, 41, 59, 0.95); color:#fff; border:1px solid rgba(255,255,255,0.3); padding:16px; border-radius: 50px; font-size:1.1rem; font-weight:bold; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; }

        .double-up-panel { display: none; gap: 15px; width: 100%; }
        .btn-collect { background: linear-gradient(90deg, #10b981, #059669); flex: 1; padding: 15px; border-radius: 15px; font-weight:bold; border:none; font-size:1.1rem; color:#fff; }
        .btn-double { background: linear-gradient(90deg, var(--main-gold), #e17055); flex: 1; padding: 15px; border-radius: 15px; font-weight:bold; border:none; font-size:1.1rem; color:#fff; }

        .choice-panel { display: none; gap: 20px; justify-content: center; margin-top: 25px; }
        .btn-choice { padding: 20px 40px; border-radius: 20px; border: none; font-size: 1.3rem; font-weight: bold; color: #fff; cursor: pointer; }
        .btn-big { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .btn-small { background: linear-gradient(135deg, #06b6d4, #0891b2); }

        .terms-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(20px); }
        .terms-box { background: #0f172a; border: 1px solid var(--main-gold); padding: 30px; border-radius: 24px; width: 85%; max-width: 450px; text-align: center; box-shadow: 0 0 60px rgba(255, 215, 0, 0.15); }
        .terms-title { font-size: 1.5rem; color: var(--main-gold); margin-bottom: 25px; font-weight: bold; }
        .terms-list { text-align: left; margin-bottom: 30px; color: #94a3b8; font-size: 1rem; line-height: 1.8; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; list-style: none; }
        .terms-list li { margin-bottom: 10px; display: flex; gap: 10px; align-items: flex-start; }
        .terms-list i { color: var(--main-gold); margin-top: 5px; }
        
        .btn-agree { background: linear-gradient(90deg, #FFD700, #FDB931) !important; color: #000 !important; border: 2px solid #fff; padding: 15px 40px; border-radius: 50px; font-weight: 900; cursor: pointer; width: 100%; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
        .btn-agree:active { transform: scale(0.95); }

    </style>
</head>
<body>

    <div id="maintenanceOverlay" class="maintenance-overlay">
        <i class="fa-solid fa-screwdriver-wrench m-icon"></i>
        <div class="m-title">ç¶­ä¿®ä¸­</div>
        <div class="m-desc">è«‹ç¨å¾Œå†è©¦</div>
        <a href="vip_area.html" class="btn-home">è¿”å›å¤§å»³</a>
    </div>

    <div class="space-container">
        <div class="star-field stars-distant"></div>
        <div class="star-field stars-mid"></div>
        <div class="gold-twinklers"></div>
    </div>
    
    <canvas id="fxCanvas"></canvas>

    <div class="terms-overlay" id="termsOverlay">
        <div class="terms-box">
            <div class="terms-title"><i class="fa-solid fa-scale-balanced"></i> æ˜Ÿæ˜Ÿå…¬ç´„</div>
            <ul class="terms-list">
                <li><i class="fa-solid fa-coins"></i> é»æ•¸åƒ…ä¾›æœ¬ç«™å¨›æ¨‚ï¼Œåš´ç¦ç¾é‡‘äº¤æ˜“ã€‚</li>
                <li><i class="fa-solid fa-dice-d20"></i> è³­åšæœ‰è³ºæœ‰è³ ï¼Œè«‹è¡¡é‡è‡ªèº«èƒ½åŠ›ã€‚</li>
                <li><i class="fa-solid fa-gavel"></i> ä¸‹æ³¨å³è¦–ç‚ºåŒæ„äº¤æ˜“ï¼Œç³»çµ±å°‡ç«‹å³æ‰£æ¬¾ï¼Œç„¡æ³•é€€å›ã€‚</li>
            </ul>
            <button class="btn-agree" onclick="closeTerms()">æˆ‘åŒæ„ä¸¦å·²çŸ¥æ‚‰</button>
        </div>
    </div>

    <div class="header">
        <a href="vip_area.html" class="back-btn"><i class="fa-solid fa-chevron-left"></i> å¤§å»³</a>
        <div class="balance-badge" id="balanceBadge">
            <i class="fa-solid fa-star"></i> <span id="userStars">--</span>
        </div>
    </div>

    <div class="vegas-title">
        <h1>æ˜Ÿç¶­åŠ æ–¯</h1>
        <p>STAR VEGAS CASINO</p>
    </div>

    <div class="game-tabs">
        <button class="tab-btn active" onclick="switchGame('wheel')">æ˜Ÿä¹‹è¼ªç›¤</button>
        <button class="tab-btn" onclick="switchGame('highcard')">æ¯”å¤§å°</button>
        <button class="tab-btn" onclick="switchGame('blackjack')">21é»</button>
        <button class="tab-btn" onclick="switchGame('dice')">æ˜Ÿé‹éª°</button>
    </div>

    <div class="stage" id="gameStage">
        
        <div class="bet-panel" id="betPanel" style="display:none;">
            <div class="bet-input-group">
                <input type="number" id="betAmount" class="bet-input" value="100">
                <button class="btn-all-in" id="btnAllIn" onclick="setAllIn()">å…¨æŠ¼</button>
            </div>
            
            <div id="diceSelector" class="dice-control-panel" style="display:none;">
                <div class="dice-header"><i class="fa-solid fa-meteor"></i> é¸æ“‡æ‚¨çš„å¹¸é‹æ˜Ÿæ•¸</div>
                <div class="dice-selector">
                    <button class="dice-btn" onclick="selectDiceNumber(1)">1</button>
                    <button class="dice-btn" onclick="selectDiceNumber(2)">2</button>
                    <button class="dice-btn" onclick="selectDiceNumber(3)">3</button>
                    <button class="dice-btn" onclick="selectDiceNumber(4)">4</button>
                    <button class="dice-btn" onclick="selectDiceNumber(5)">5</button>
                    <button class="dice-btn" onclick="selectDiceNumber(6)">6</button>
                </div>
            </div>

            <button class="btn-action" id="btnStart" onclick="startGame()">é–‹å§‹</button>
        </div>

        <div id="gameWheel" style="display:block;">
            <div style="text-align:center; color:#94a3b8; margin-bottom:20px;">æ¯æ—¥ä¹é»åˆ·æ–°èƒ½æº</div>
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <canvas id="wheelCanvas" width="300" height="300"></canvas>
                <button class="wheel-center" id="btnSpin" onclick="spinWheel()" disabled>GO</button>
                <div id="wheelCooldown" class="cooldown-overlay" style="display:none;">
                    <i class="fa-solid fa-hourglass-half" style="font-size:3rem;"></i>
                    <div class="timer-text" id="cooldownTimer">--:--:--</div>
                </div>
            </div>
        </div>

        <div id="gameHighCard" style="display:none;">
            <div class="card-area" id="hcHouseCard"><div class="poker-card card-back"></div></div>
            <div class="card-area" id="hcPlayerCard"><div class="poker-card card-back" style="opacity:0.5;"></div></div>
            <div class="choice-panel" id="hcChoices">
                <button class="btn-choice btn-big" onclick="guessHighCard('big')">å¤§ BIG</button>
                <button class="btn-choice btn-small" onclick="guessHighCard('small')">å° SMALL</button>
            </div>
        </div>

        <div id="gameBlackjack" style="display:none;">
            <div style="margin-bottom:30px;">
                <div style="color:#94a3b8; margin-bottom:10px; letter-spacing:1px;">
                    <i class="fa-solid fa-user-secret"></i> èŠå®¶ <span id="bjHouseScore" class="score-box" style="color:#fff;">?</span>
                </div>
                <div class="card-area" id="bjHouseArea">
                    <div class="poker-card card-back" style="opacity:0.2; border:1px dashed #666; background:transparent;"></div>
                    <div class="poker-card card-back" style="opacity:0.2; border:1px dashed #666; background:transparent;"></div>
                </div>
            </div>
            <div>
                <div style="color:var(--main-gold); margin-bottom:10px; font-weight:bold; letter-spacing:1px;">
                    <i class="fa-solid fa-user"></i> æ‚¨ <span id="bjPlayerScore" class="score-box" style="color:var(--main-gold);">0</span>
                </div>
                <div class="card-area" id="bjPlayerArea">
                    <div class="poker-card card-back" style="opacity:0.2; border:1px dashed #666; background:transparent;"></div>
                    <div class="poker-card card-back" style="opacity:0.2; border:1px dashed #666; background:transparent;"></div>
                </div>
            </div>
            <div class="bj-controls" id="bjControls">
                <button class="btn-bj btn-hit" onclick="bjHit()">å«ç‰Œ</button>
                <button class="btn-bj btn-stand" onclick="bjStand()">åœç‰Œ</button>
            </div>
        </div>

        <div id="gameDice" style="display:none;">
            <div class="dice-container">
                <div class="dice-glow"></div>
                <div class="dice-display"><i class="fa-solid fa-dice-d6" id="diceIcon"></i></div>
            </div>
            <div id="diceStatus" style="color:#d946ef; margin-top:20px; font-weight:bold; letter-spacing:1px;">ç­‰å¾…æ˜Ÿé‹é™è‡¨...</div>
        </div>

        <div id="resultMsg" class="result-msg"></div>
    </div>

    <div class="bottom-float-bar">
        <div class="double-up-panel" id="doubleUpPanel">
            <button class="btn-collect" onclick="collectWinnings()">æ”¶ä¸‹</button>
            <button class="btn-double" onclick="doubleUp()">åŠ å€</button>
        </div>
        <button id="btnReset" onclick="resetTable()">å†ä¾†ä¸€å±€</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, runTransaction, collection, serverTimestamp, setDoc, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAAo6on0f2QUbPaRfxpIEb2uvhKxDvPUvs",
            authDomain: "yulubox.firebaseapp.com",
            projectId: "yulubox",
            storageBucket: "yulubox.firebasestorage.app",
            messagingSenderId: "256466567852",
            appId: "1:256466567852:web:233b74668908ffcb9b9509",
            measurementId: "G-YPCY41EKWX"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentBalance = 0;
        let currentGame = 'wheel'; 
        let isWheelSpinning = true; 
        let selectedDice = null;
        let gameState = { bet: 0, pendingWinnings: 0 };
        // ğŸ”¥ å‹•æ…‹é›£åº¦è®Šæ•¸: 0=Normal, 1=Hard, 2=Hell
        let roundDifficulty = 0; 
        // ğŸ”¥ å…¨åŸŸé˜²å‘†é–
        let isProcessing = false;

        const canvas = document.getElementById('fxCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function createConfetti() {
            particles = [];
            for(let i=0; i<120; i++) particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height - canvas.height, vx: Math.random()*4-2, vy: Math.random()*5+2, color: `hsl(${Math.random()*50+40},100%,60%)`, size: Math.random()*8+4 });
            animateConfetti();
        }
        function animateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            particles.forEach(p => { p.x += p.vx; p.y += p.vy; if(p.y < canvas.height) { active = true; ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.size, p.size); } });
            if(active) requestAnimationFrame(animateConfetti);
        }

        window.closeTerms = () => { document.getElementById('termsOverlay').style.display = 'none'; }

        onAuthStateChanged(auth, async (user) => {
            if (user) { 
                currentUser = user; 
                updateBalanceDisplay();
                initWheel(); 
                checkDailyStatus();
                listenCasinoStatus(); 
            } else { window.location.href = "login.html"; }
        });

        // ç›£è½ç³»çµ±è¨­å®š
        function listenCasinoStatus() {
            onSnapshot(doc(db, "system_settings", "global_config"), (docSnap) => {
                const overlay = document.getElementById('maintenanceOverlay');
                if(docSnap.exists() && docSnap.data().isCasinoOpen === false) {
                    overlay.classList.add('active');
                } else {
                    overlay.classList.remove('active');
                }
            });
        }

        async function updateBalanceDisplay() {
            const docSnap = await getDoc(doc(db, "users", currentUser.uid));
            if(docSnap.exists()) {
                currentBalance = docSnap.data().stars || 0;
                document.getElementById('userStars').innerText = currentBalance;
                const c = document.getElementById('balanceBadge'); c.classList.remove('balance-update'); void c.offsetWidth; c.classList.add('balance-update');
            }
        }

        window.switchGame = (game) => {
            currentGame = game;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('gameHighCard').style.display = game === 'highcard' ? 'block' : 'none';
            document.getElementById('gameBlackjack').style.display = game === 'blackjack' ? 'block' : 'none';
            document.getElementById('gameDice').style.display = game === 'dice' ? 'block' : 'none';
            document.getElementById('gameWheel').style.display = game === 'wheel' ? 'block' : 'none';
            
            document.getElementById('betPanel').style.display = game === 'wheel' ? 'none' : 'block';
            document.getElementById('diceSelector').style.display = game === 'dice' ? 'flex' : 'none';
            
            resetTable();
        };

        window.selectDiceNumber = (num) => {
            selectedDice = num;
            document.querySelectorAll('.dice-btn').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.dice-btn')[num-1].classList.add('selected');
        }

        window.resetTable = () => {
            document.getElementById('betPanel').style.display = currentGame === 'wheel' ? 'none' : 'block';
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnReset').style.display = 'none';
            document.getElementById('doubleUpPanel').style.display = 'none';
            document.getElementById('resultMsg').innerText = '';
            document.getElementById('resultMsg').className = 'result-msg';
            document.getElementById('betAmount').disabled = false;
            document.getElementById('gameStage').classList.remove('winner-glow', 'loser-shake');
            document.getElementById('hcChoices').style.display = 'none';

            document.getElementById('diceIcon').className = 'fa-solid fa-dice-d6';
            document.getElementById('diceStatus').innerText = 'ç­‰å¾…æ˜Ÿé‹é™è‡¨...';
            document.getElementById('bjControls').style.display = 'none';
            
            document.getElementById('hcPlayerCard').innerHTML = '<div class="poker-card card-back" style="opacity:0.5;"></div>';
            document.getElementById('hcHouseCard').innerHTML = '<div class="poker-card card-back"></div>';
            document.getElementById('bjPlayerArea').innerHTML = '<div class="poker-card card-back" style="opacity:0.3; border:1px dashed #666; background:transparent;"></div><div class="poker-card card-back" style="opacity:0.3; border:1px dashed #666; background:transparent;"></div>';
            document.getElementById('bjHouseArea').innerHTML = '<div class="poker-card card-back" style="opacity:0.3; border:1px dashed #666; background:transparent;"></div><div class="poker-card card-back" style="opacity:0.3; border:1px dashed #666; background:transparent;"></div>';
            document.getElementById('bjPlayerScore').innerText = '0';
            document.getElementById('bjHouseScore').innerText = '?';

            // è§£é–æ‰€æœ‰æŒ‰éˆ•
            toggleAllButtons(false);
            isProcessing = false;

            gameState.pendingWinnings = 0;
        };

        // ğŸ”¥ çµ±ä¸€ç®¡ç†æŒ‰éˆ•é–å®š (Lock/Unlock)
        function toggleAllButtons(disabled) {
            const btns = document.querySelectorAll('.btn-choice, .btn-bj, .btn-collect, .btn-double, #btnStart, #btnAllIn');
            btns.forEach(b => b.disabled = disabled);
        }

        // ğŸƒ ç‰Œå †å®šç¾© (A=1, K=13)
        const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
        // ğŸ”¥ é«˜ç‰Œæ¯”å¤§å°: A(1) < 2 ... < K(13)
        // ğŸ”¥ 21é»: A(1/11), K(10)
        const VALUES = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        function createDeck() { 
            let d = []; 
            for(let s of SUITS) {
                for(let i=0; i<13; i++) {
                    // hcValue: A=1, 2=2 ... K=13 (æ¯”å¤§å°ç”¨)
                    // bjValue: A=11, 2=2 ... 10/J/Q/K=10 (21é»ç”¨)
                    let val = i+1; 
                    let bjVal = (i>=9) ? 10 : (i===0 ? 11 : val);
                    d.push({
                        suit:s, 
                        text:VALUES[i], 
                        hcValue: val, 
                        bjValue: bjVal
                    });
                }
            }
            // ğŸ”¥ é›£åº¦é‚è¼¯ (Hell Mode: ç§»é™¤ A)
            if (currentGame === 'blackjack' && roundDifficulty === 2) d = d.filter(c => c.text !== 'A'); 
            return d.sort(() => Math.random() - 0.5);
        }

        function createCardElement(c) {
            const red = (c.suit === 'â™¥' || c.suit === 'â™¦') ? 'card-red' : 'card-black';
            const div = document.createElement('div'); div.className = `poker-card ${red}`;
            div.innerHTML = `<div class="card-corner top-left"><div>${c.text}</div><div>${c.suit}</div></div><div class="card-center">${c.suit}</div><div class="card-corner bottom-right"><div>${c.text}</div><div>${c.suit}</div></div>`;
            return div;
        }

        function createCardBack() { const d = document.createElement('div'); d.className = 'poker-card card-back'; return d; }

        window.startGame = async (isDoubleUp = false) => {
            if (isProcessing) return; // ğŸ”¥ é˜²é€£é»

            let bet = 0;
            if(!isDoubleUp) {
                bet = parseInt(document.getElementById('betAmount').value);
                if(isNaN(bet) || bet <= 0 || bet > currentBalance) return alert("é‡‘é¡ç„¡æ•ˆæˆ–ä¸è¶³");
                if(currentGame === 'dice' && !selectedDice) return alert("è«‹å…ˆé æ¸¬");

                // ğŸ”¥ é–å®šä¸¦é–‹å§‹æ‰£æ¬¾
                isProcessing = true;
                toggleAllButtons(true);

                // ğŸ”¥ è¨­å®šæœ¬å±€é›£åº¦
                const rand = Math.random();
                if(rand < 0.2) roundDifficulty = 0;
                else if(rand < 0.7) roundDifficulty = 1;
                else roundDifficulty = 2;

                try {
                    await runTransaction(db, async (t) => {
                        const ref = doc(db, "users", currentUser.uid);
                        const snap = await t.get(ref);
                        const bal = snap.data().stars || 0;
                        if(bal < bet) throw "é¤˜é¡ä¸è¶³";
                        t.update(ref, { stars: bal - bet });
                        t.set(doc(collection(db, "transactions")), { userId: currentUser.uid, action: "gamble_bet", itemName: currentGame, amount: -bet, timestamp: serverTimestamp() });
                    });
                    updateBalanceDisplay();
                } catch(e) { 
                    alert("äº¤æ˜“å¤±æ•—: " + e); 
                    isProcessing = false;
                    toggleAllButtons(false);
                    return; 
                }
                gameState.bet = bet;
            } else {
                if(roundDifficulty < 2) roundDifficulty++;
            }

            document.getElementById('betPanel').style.display = 'none';
            document.getElementById('doubleUpPanel').style.display = 'none';
            document.getElementById('btnReset').style.display = 'none';
            
            if(currentGame === 'highcard') startHighCard();
            else if(currentGame === 'blackjack') startBlackjack();
            else startDice();
        };

        // --- ğŸ² Dice Logic (å‹•ç•« + é›£åº¦) ---
        function startDice() {
            const icon = document.getElementById('diceIcon'); 
            const status = document.getElementById('diceStatus');
            
            // æ•¸å­—è·³å‹•å‹•ç•«
            let counter = 0;
            const interval = setInterval(() => {
                const r = Math.floor(Math.random()*6)+1;
                const faces = ['one','two','three','four','five','six'];
                icon.className = `fa-solid fa-dice-${faces[r-1]} dice-rolling`;
                counter++;
                if(counter > 15) {
                    clearInterval(interval);
                    finalizeDice();
                }
            }, 100);
        }

        function finalizeDice() {
            let res = Math.floor(Math.random()*6)+1;
            // ğŸ”¥ é›£åº¦é‚è¼¯ (æ®ºç‰Œ)
            if (res === selectedDice && roundDifficulty > 0) {
                const killRate = roundDifficulty === 1 ? 0.3 : 0.6;
                if (Math.random() < killRate) {
                    do { res = Math.floor(Math.random()*6)+1; } while(res === selectedDice);
                }
            }

            const faces = ['one','two','three','four','five','six']; 
            const icon = document.getElementById('diceIcon');
            icon.className = `fa-solid fa-dice-${faces[res-1]}`;
            
            if(res === selectedDice) handleWin(3, "æ˜Ÿé‹çˆ†ç™¼ï¼"); 
            else handleLose(`é–‹å‡º ${res}ï¼ŒæŒ‘æˆ°å¤±æ•—`);
        }

        // --- ğŸƒ HighCard Logic (A=1, K=13) ---
        function startHighCard() {
            setTimeout(() => {
                const deck = createDeck(); gameState.deck = deck;
                const house = deck.pop(); gameState.house = house;
                document.getElementById('hcHouseCard').innerHTML = '';
                document.getElementById('hcHouseCard').appendChild(createCardElement(house));
                document.getElementById('hcChoices').style.display = 'flex';
                toggleAllButtons(false); // è§£é–é¸æ“‡
                isProcessing = false;
            }, 500);
        }
        window.guessHighCard = (choice) => {
            if(isProcessing) return; // ğŸ”¥ é˜²é€£é»
            isProcessing = true;
            toggleAllButtons(true);
            document.getElementById('hcChoices').style.display = 'none';
            
            let player = gameState.deck.pop();
            // ğŸ”¥ é›£åº¦é‚è¼¯ (å·æ›ç‰Œ)
            const hVal = gameState.house.hcValue;
            const pVal = player.hcValue;

            const playerWins = (choice==='big' && pVal > hVal) || (choice==='small' && pVal < hVal);
            
            if (playerWins && roundDifficulty > 0) {
                const swapRate = roundDifficulty === 1 ? 0.4 : 0.7;
                if (Math.random() < swapRate) {
                    for(let i=0; i<8; i++) {
                        let temp = gameState.deck.pop();
                        const tVal = temp.hcValue;
                        const newWin = (choice==='big' && tVal > hVal) || (choice==='small' && tVal < hVal);
                        if (!newWin) { player = temp; break; }
                    }
                }
            }

            document.getElementById('hcPlayerCard').innerHTML = '';
            document.getElementById('hcPlayerCard').appendChild(createCardElement(player));
            setTimeout(() => {
                const pVal2 = player.hcValue;
                const hVal2 = gameState.house.hcValue;
                const win = (choice==='big' && pVal2 > hVal2) || (choice==='small' && pVal2 < hVal2);
                if(win) handleWin(2, "çŒœå°äº†ï¼"); else if(pVal2 === hVal2) handleWin(1, "å¹³æ‰‹"); else handleLose();
            }, 600);
        };

        // --- ğŸƒ Blackjack Logic (Max 3 cards) ---
        function startBlackjack() {
            gameState.deck = createDeck(); 
            // ğŸ”¥ é›£åº¦é‚è¼¯ (èŠå®¶å„ªå‹¢)
            if (roundDifficulty > 0 && Math.random() < 0.6) {
                gameState.hCards = [{suit:'â™ ', text:'K', bjValue:10}, gameState.deck.pop()];
            } else {
                gameState.hCards = [gameState.deck.pop(), gameState.deck.pop()]; 
            }
            gameState.pCards = [gameState.deck.pop(), gameState.deck.pop()];
            renderBJ(); 
            document.getElementById('bjControls').style.display = 'flex';
            toggleAllButtons(false);
            isProcessing = false;
        }
        function renderBJ(reveal=false) {
            const pArea = document.getElementById('bjPlayerArea'), hArea = document.getElementById('bjHouseArea');
            pArea.innerHTML = ''; gameState.pCards.forEach(c => pArea.appendChild(createCardElement(c)));
            hArea.innerHTML = ''; gameState.hCards.forEach((c,i) => hArea.appendChild(!reveal && i===1 ? createCardBack() : createCardElement(c)));
            document.getElementById('bjPlayerScore').innerText = getBJScore(gameState.pCards);
            document.getElementById('bjHouseScore').innerText = reveal ? getBJScore(gameState.hCards) : "?";
        }
        function getBJScore(cards) {
            let s = 0, a = 0; for(let c of cards) { s+=c.bjValue; if(c.text==='A') a++; }
            while(s > 21 && a > 0) { s-=10; a--; } return s;
        }
        window.bjHit = () => { 
            if(isProcessing) return; 
            // ğŸ”¥ 3å¼µç‰Œé™åˆ¶
            if (gameState.pCards.length >= 3) {
                alert("æ¯äººæœ€å¤šåªèƒ½æ‹¿ 3 å¼µç‰Œï¼");
                return;
            }

            isProcessing = true; toggleAllButtons(true);
            gameState.pCards.push(gameState.deck.pop()); 
            renderBJ(); 
            
            // çˆ†ç‰Œæˆ–æ»¿3å¼µå¼·åˆ¶åœç‰Œ
            if(getBJScore(gameState.pCards) > 21) {
                bjStand();
            } else if (gameState.pCards.length === 3) {
                 setTimeout(bjStand, 500); // è‡ªå‹•åœç‰Œ
            } else { 
                isProcessing = false; toggleAllButtons(false); 
            }
        };
        window.bjStand = () => {
            if(isProcessing && gameState.pCards.length !== 3 && getBJScore(gameState.pCards) <= 21) return; // é™¤éè‡ªå‹•åœç‰Œï¼Œå¦å‰‡é˜²å‘†
            isProcessing = true; toggleAllButtons(true);
            document.getElementById('bjControls').style.display = 'none';
            
            // èŠå®¶è£œç‰Œ (é™åˆ¶ 3 å¼µ)
            while(getBJScore(gameState.hCards) < 17 && gameState.hCards.length < 3) {
                gameState.hCards.push(gameState.deck.pop()); 
            }

            renderBJ(true);
            const ps = getBJScore(gameState.pCards), hs = getBJScore(gameState.hCards);
            setTimeout(() => {
                if(ps > 21) handleLose("çˆ†ç‰Œï¼"); else if(hs > 21 || ps > hs) handleWin(2, "ç²å‹ï¼"); else if(ps === hs) handleWin(1, "å¹³æ‰‹"); else handleLose();
            }, 600);
        };

        function handleWin(mul, msg) {
            const win = gameState.bet * mul; gameState.pendingWinnings = win;
            document.getElementById('resultMsg').innerText = msg + " è´å¾— " + win; document.getElementById('resultMsg').className += " show win";
            document.getElementById('doubleUpPanel').style.display = 'flex';
            toggleAllButtons(false); isProcessing = false;
            confettiFx();
            
            // Auto Honor
            if (win >= 500) {
                try {
                    addDoc(collection(db, "bulletin_board"), {
                        type: 'honor',
                        content: `æ­å–œ ${currentUser.displayName} åœ¨ã€${currentGame === 'dice' ? 'æ˜Ÿé‹éª°' : (currentGame === 'highcard' ? 'æ¯”å¤§å°' : '21é»')}ã€‘è´å¾—äº† ${win} æ˜Ÿæ˜Ÿï¼`,
                        authorId: 'system',
                        timestamp: serverTimestamp()
                    });
                } catch(e) {}
            }
        }
        function handleLose(msg="è¼¸äº†...") {
            document.getElementById('resultMsg').innerText = msg; document.getElementById('resultMsg').className += " show lose";
            document.getElementById('btnReset').style.display = 'block';
            toggleAllButtons(false); isProcessing = false;
        }
        window.collectWinnings = async () => {
            if(isProcessing) return; // ğŸ”¥ é˜²é€£é»
            isProcessing = true; toggleAllButtons(true);
            try {
                await runTransaction(db, async (t) => {
                    const ref = doc(db, "users", currentUser.uid);
                    const snap = await t.get(ref);
                    t.update(ref, { stars: snap.data().stars + gameState.pendingWinnings });
                    t.set(doc(collection(db, "transactions")), { userId: currentUser.uid, action: "gamble_win", itemName: currentGame, amount: gameState.pendingWinnings, timestamp: serverTimestamp() });
                });
                updateBalanceDisplay(); resetTable();
            } catch(e) { 
                isProcessing = false; toggleAllButtons(false); 
            }
        };
        window.doubleUp = () => { if(isProcessing) return; isProcessing = false; gameState.pendingWinnings = 0; startGame(true); };

    </script>
</body>
</html>